(function(){var requirejs,require,define;(function(e){function c(e,t){return f.call(e,t)}function h(e,t){var n,r,i,s,o,a,f,l,c,h,p=t&&t.split("/"),d=u.map,v=d&&d["*"]||{};if(e&&e.charAt(0)===".")if(t){p=p.slice(0,p.length-1),e=p.concat(e.split("/"));for(l=0;l<e.length;l+=1){h=e[l];if(h===".")e.splice(l,1),l-=1;else if(h===".."){if(l===1&&(e[2]===".."||e[0]===".."))break;l>0&&(e.splice(l-1,2),l-=2)}}e=e.join("/")}else e.indexOf("./")===0&&(e=e.substring(2));if((p||v)&&d){n=e.split("/");for(l=n.length;l>0;l-=1){r=n.slice(0,l).join("/");if(p)for(c=p.length;c>0;c-=1){i=d[p.slice(0,c).join("/")];if(i){i=i[r];if(i){s=i,o=l;break}}}if(s)break;!a&&v&&v[r]&&(a=v[r],f=l)}!s&&a&&(s=a,o=f),s&&(n.splice(0,o,s),e=n.join("/"))}return e}function p(t,r){return function(){return n.apply(e,l.call(arguments,0).concat([t,r]))}}function d(e){return function(t){return h(t,e)}}function v(e){return function(t){s[e]=t}}function m(n){if(c(o,n)){var r=o[n];delete o[n],a[n]=!0,t.apply(e,r)}if(!c(s,n)&&!c(a,n))throw new Error("No "+n);return s[n]}function g(e){var t,n=e?e.indexOf("!"):-1;return n>-1&&(t=e.substring(0,n),e=e.substring(n+1,e.length)),[t,e]}function y(e){return function(){return u&&u.config&&u.config[e]||{}}}var t,n,r,i,s={},o={},u={},a={},f=Object.prototype.hasOwnProperty,l=[].slice;r=function(e,t){var n,r=g(e),i=r[0];return e=r[1],i&&(i=h(i,t),n=m(i)),i?n&&n.normalize?e=n.normalize(e,d(t)):e=h(e,t):(e=h(e,t),r=g(e),i=r[0],e=r[1],i&&(n=m(i))),{f:i?i+"!"+e:e,n:e,pr:i,p:n}},i={require:function(e){return p(e)},exports:function(e){var t=s[e];return typeof t!="undefined"?t:s[e]={}},module:function(e){return{id:e,uri:"",exports:s[e],config:y(e)}}},t=function(t,n,u,f){var l,h,d,g,y,b=[],w;f=f||t;if(typeof u=="function"){n=!n.length&&u.length?["require","exports","module"]:n;for(y=0;y<n.length;y+=1){g=r(n[y],f),h=g.f;if(h==="require")b[y]=i.require(t);else if(h==="exports")b[y]=i.exports(t),w=!0;else if(h==="module")l=b[y]=i.module(t);else if(c(s,h)||c(o,h)||c(a,h))b[y]=m(h);else{if(!g.p)throw new Error(t+" missing "+h);g.p.load(g.n,p(f,!0),v(h),{}),b[y]=s[h]}}d=u.apply(s[t],b);if(t)if(l&&l.exports!==e&&l.exports!==s[t])s[t]=l.exports;else if(d!==e||!w)s[t]=d}else t&&(s[t]=u)},requirejs=require=n=function(s,o,a,f,l){return typeof s=="string"?i[s]?i[s](o):m(r(s,o).f):(s.splice||(u=s,o.splice?(s=o,o=a,a=null):s=e),o=o||function(){},typeof a=="function"&&(a=f,f=l),f?t(e,s,o,a):setTimeout(function(){t(e,s,o,a)},4),n)},n.config=function(e){return u=e,u.deps&&n(u.deps,u.callback),n},requirejs._defined=s,define=function(e,t,n){t.splice||(n=t,t=[]),!c(s,e)&&!c(o,e)&&(o[e]=[e,t,n])},define.amd={jQuery:!0}})(),define("almond",function(){}),function(){var e=this,t=e._,n={},r=Array.prototype,i=Object.prototype,s=Function.prototype,o=r.push,u=r.slice,a=r.concat,f=i.toString,l=i.hasOwnProperty,c=r.forEach,h=r.map,p=r.reduce,d=r.reduceRight,v=r.filter,m=r.every,g=r.some,y=r.indexOf,b=r.lastIndexOf,w=Array.isArray,E=Object.keys,S=s.bind,x=function(e){if(e instanceof x)return e;if(!(this instanceof x))return new x(e);this._wrapped=e};typeof exports!="undefined"?(typeof module!="undefined"&&module.exports&&(exports=module.exports=x),exports._=x):e._=x,x.VERSION="1.4.4";var T=x.each=x.forEach=function(e,t,r){if(e==null)return;if(c&&e.forEach===c)e.forEach(t,r);else if(e.length===+e.length){for(var i=0,s=e.length;i<s;i++)if(t.call(r,e[i],i,e)===n)return}else for(var o in e)if(x.has(e,o)&&t.call(r,e[o],o,e)===n)return};x.map=x.collect=function(e,t,n){var r=[];return e==null?r:h&&e.map===h?e.map(t,n):(T(e,function(e,i,s){r[r.length]=t.call(n,e,i,s)}),r)};var N="Reduce of empty array with no initial value";x.reduce=x.foldl=x.inject=function(e,t,n,r){var i=arguments.length>2;e==null&&(e=[]);if(p&&e.reduce===p)return r&&(t=x.bind(t,r)),i?e.reduce(t,n):e.reduce(t);T(e,function(e,s,o){i?n=t.call(r,n,e,s,o):(n=e,i=!0)});if(!i)throw new TypeError(N);return n},x.reduceRight=x.foldr=function(e,t,n,r){var i=arguments.length>2;e==null&&(e=[]);if(d&&e.reduceRight===d)return r&&(t=x.bind(t,r)),i?e.reduceRight(t,n):e.reduceRight(t);var s=e.length;if(s!==+s){var o=x.keys(e);s=o.length}T(e,function(u,a,f){a=o?o[--s]:--s,i?n=t.call(r,n,e[a],a,f):(n=e[a],i=!0)});if(!i)throw new TypeError(N);return n},x.find=x.detect=function(e,t,n){var r;return C(e,function(e,i,s){if(t.call(n,e,i,s))return r=e,!0}),r},x.filter=x.select=function(e,t,n){var r=[];return e==null?r:v&&e.filter===v?e.filter(t,n):(T(e,function(e,i,s){t.call(n,e,i,s)&&(r[r.length]=e)}),r)},x.reject=function(e,t,n){return x.filter(e,function(e,r,i){return!t.call(n,e,r,i)},n)},x.every=x.all=function(e,t,r){t||(t=x.identity);var i=!0;return e==null?i:m&&e.every===m?e.every(t,r):(T(e,function(e,s,o){if(!(i=i&&t.call(r,e,s,o)))return n}),!!i)};var C=x.some=x.any=function(e,t,r){t||(t=x.identity);var i=!1;return e==null?i:g&&e.some===g?e.some(t,r):(T(e,function(e,s,o){if(i||(i=t.call(r,e,s,o)))return n}),!!i)};x.contains=x.include=function(e,t){return e==null?!1:y&&e.indexOf===y?e.indexOf(t)!=-1:C(e,function(e){return e===t})},x.invoke=function(e,t){var n=u.call(arguments,2),r=x.isFunction(t);return x.map(e,function(e){return(r?t:e[t]).apply(e,n)})},x.pluck=function(e,t){return x.map(e,function(e){return e[t]})},x.where=function(e,t,n){return x.isEmpty(t)?n?null:[]:x[n?"find":"filter"](e,function(e){for(var n in t)if(t[n]!==e[n])return!1;return!0})},x.findWhere=function(e,t){return x.where(e,t,!0)},x.max=function(e,t,n){if(!t&&x.isArray(e)&&e[0]===+e[0]&&e.length<65535)return Math.max.apply(Math,e);if(!t&&x.isEmpty(e))return-Infinity;var r={computed:-Infinity,value:-Infinity};return T(e,function(e,i,s){var o=t?t.call(n,e,i,s):e;o>=r.computed&&(r={value:e,computed:o})}),r.value},x.min=function(e,t,n){if(!t&&x.isArray(e)&&e[0]===+e[0]&&e.length<65535)return Math.min.apply(Math,e);if(!t&&x.isEmpty(e))return Infinity;var r={computed:Infinity,value:Infinity};return T(e,function(e,i,s){var o=t?t.call(n,e,i,s):e;o<r.computed&&(r={value:e,computed:o})}),r.value},x.shuffle=function(e){var t,n=0,r=[];return T(e,function(e){t=x.random(n++),r[n-1]=r[t],r[t]=e}),r};var k=function(e){return x.isFunction(e)?e:function(t){return t[e]}};x.sortBy=function(e,t,n){var r=k(t);return x.pluck(x.map(e,function(e,t,i){return{value:e,index:t,criteria:r.call(n,e,t,i)}}).sort(function(e,t){var n=e.criteria,r=t.criteria;if(n!==r){if(n>r||n===void 0)return 1;if(n<r||r===void 0)return-1}return e.index<t.index?-1:1}),"value")};var L=function(e,t,n,r){var i={},s=k(t||x.identity);return T(e,function(t,o){var u=s.call(n,t,o,e);r(i,u,t)}),i};x.groupBy=function(e,t,n){return L(e,t,n,function(e,t,n){(x.has(e,t)?e[t]:e[t]=[]).push(n)})},x.countBy=function(e,t,n){return L(e,t,n,function(e,t){x.has(e,t)||(e[t]=0),e[t]++})},x.sortedIndex=function(e,t,n,r){n=n==null?x.identity:k(n);var i=n.call(r,t),s=0,o=e.length;while(s<o){var u=s+o>>>1;n.call(r,e[u])<i?s=u+1:o=u}return s},x.toArray=function(e){return e?x.isArray(e)?u.call(e):e.length===+e.length?x.map(e,x.identity):x.values(e):[]},x.size=function(e){return e==null?0:e.length===+e.length?e.length:x.keys(e).length},x.first=x.head=x.take=function(e,t,n){return e==null?void 0:t!=null&&!n?u.call(e,0,t):e[0]},x.initial=function(e,t,n){return u.call(e,0,e.length-(t==null||n?1:t))},x.last=function(e,t,n){return e==null?void 0:t!=null&&!n?u.call(e,Math.max(e.length-t,0)):e[e.length-1]},x.rest=x.tail=x.drop=function(e,t,n){return u.call(e,t==null||n?1:t)},x.compact=function(e){return x.filter(e,x.identity)};var A=function(e,t,n){return T(e,function(e){x.isArray(e)?t?o.apply(n,e):A(e,t,n):n.push(e)}),n};x.flatten=function(e,t){return A(e,t,[])},x.without=function(e){return x.difference(e,u.call(arguments,1))},x.uniq=x.unique=function(e,t,n,r){x.isFunction(t)&&(r=n,n=t,t=!1);var i=n?x.map(e,n,r):e,s=[],o=[];return T(i,function(n,r){if(t?!r||o[o.length-1]!==n:!x.contains(o,n))o.push(n),s.push(e[r])}),s},x.union=function(){return x.uniq(a.apply(r,arguments))},x.intersection=function(e){var t=u.call(arguments,1);return x.filter(x.uniq(e),function(e){return x.every(t,function(t){return x.indexOf(t,e)>=0})})},x.difference=function(e){var t=a.apply(r,u.call(arguments,1));return x.filter(e,function(e){return!x.contains(t,e)})},x.zip=function(){var e=u.call(arguments),t=x.max(x.pluck(e,"length")),n=new Array(t);for(var r=0;r<t;r++)n[r]=x.pluck(e,""+r);return n},x.object=function(e,t){if(e==null)return{};var n={};for(var r=0,i=e.length;r<i;r++)t?n[e[r]]=t[r]:n[e[r][0]]=e[r][1];return n},x.indexOf=function(e,t,n){if(e==null)return-1;var r=0,i=e.length;if(n){if(typeof n!="number")return r=x.sortedIndex(e,t),e[r]===t?r:-1;r=n<0?Math.max(0,i+n):n}if(y&&e.indexOf===y)return e.indexOf(t,n);for(;r<i;r++)if(e[r]===t)return r;return-1},x.lastIndexOf=function(e,t,n){if(e==null)return-1;var r=n!=null;if(b&&e.lastIndexOf===b)return r?e.lastIndexOf(t,n):e.lastIndexOf(t);var i=r?n:e.length;while(i--)if(e[i]===t)return i;return-1},x.range=function(e,t,n){arguments.length<=1&&(t=e||0,e=0),n=arguments[2]||1;var r=Math.max(Math.ceil((t-e)/n),0),i=0,s=new Array(r);while(i<r)s[i++]=e,e+=n;return s},x.bind=function(e,t){if(e.bind===S&&S)return S.apply(e,u.call(arguments,1));var n=u.call(arguments,2);return function(){return e.apply(t,n.concat(u.call(arguments)))}},x.partial=function(e){var t=u.call(arguments,1);return function(){return e.apply(this,t.concat(u.call(arguments)))}},x.bindAll=function(e){var t=u.call(arguments,1);return t.length===0&&(t=x.functions(e)),T(t,function(t){e[t]=x.bind(e[t],e)}),e},x.memoize=function(e,t){var n={};return t||(t=x.identity),function(){var r=t.apply(this,arguments);return x.has(n,r)?n[r]:n[r]=e.apply(this,arguments)}},x.delay=function(e,t){var n=u.call(arguments,2);return setTimeout(function(){return e.apply(null,n)},t)},x.defer=function(e){return x.delay.apply(x,[e,1].concat(u.call(arguments,1)))},x.throttle=function(e,t){var n,r,i,s,o=0,u=function(){o=new Date,i=null,s=e.apply(n,r)};return function(){var a=new Date,f=t-(a-o);return n=this,r=arguments,f<=0?(clearTimeout(i),i=null,o=a,s=e.apply(n,r)):i||(i=setTimeout(u,f)),s}},x.debounce=function(e,t,n){var r,i;return function(){var s=this,o=arguments,u=function(){r=null,n||(i=e.apply(s,o))},a=n&&!r;return clearTimeout(r),r=setTimeout(u,t),a&&(i=e.apply(s,o)),i}},x.once=function(e){var t=!1,n;return function(){return t?n:(t=!0,n=e.apply(this,arguments),e=null,n)}},x.wrap=function(e,t){return function(){var n=[e];return o.apply(n,arguments),t.apply(this,n)}},x.compose=function(){var e=arguments;return function(){var t=arguments;for(var n=e.length-1;n>=0;n--)t=[e[n].apply(this,t)];return t[0]}},x.after=function(e,t){return e<=0?t():function(){if(--e<1)return t.apply(this,arguments)}},x.keys=E||function(e){if(e!==Object(e))throw new TypeError("Invalid object");var t=[];for(var n in e)x.has(e,n)&&(t[t.length]=n);return t},x.values=function(e){var t=[];for(var n in e)x.has(e,n)&&t.push(e[n]);return t},x.pairs=function(e){var t=[];for(var n in e)x.has(e,n)&&t.push([n,e[n]]);return t},x.invert=function(e){var t={};for(var n in e)x.has(e,n)&&(t[e[n]]=n);return t},x.functions=x.methods=function(e){var t=[];for(var n in e)x.isFunction(e[n])&&t.push(n);return t.sort()},x.extend=function(e){return T(u.call(arguments,1),function(t){if(t)for(var n in t)e[n]=t[n]}),e},x.pick=function(e){var t={},n=a.apply(r,u.call(arguments,1));return T(n,function(n){n in e&&(t[n]=e[n])}),t},x.omit=function(e){var t={},n=a.apply(r,u.call(arguments,1));for(var i in e)x.contains(n,i)||(t[i]=e[i]);return t},x.defaults=function(e){return T(u.call(arguments,1),function(t){if(t)for(var n in t)e[n]==null&&(e[n]=t[n])}),e},x.clone=function(e){return x.isObject(e)?x.isArray(e)?e.slice():x.extend({},e):e},x.tap=function(e,t){return t(e),e};var O=function(e,t,n,r){if(e===t)return e!==0||1/e==1/t;if(e==null||t==null)return e===t;e instanceof x&&(e=e._wrapped),t instanceof x&&(t=t._wrapped);var i=f.call(e);if(i!=f.call(t))return!1;switch(i){case"[object String]":return e==String(t);case"[object Number]":return e!=+e?t!=+t:e==0?1/e==1/t:e==+t;case"[object Date]":case"[object Boolean]":return+e==+t;case"[object RegExp]":return e.source==t.source&&e.global==t.global&&e.multiline==t.multiline&&e.ignoreCase==t.ignoreCase}if(typeof e!="object"||typeof t!="object")return!1;var s=n.length;while(s--)if(n[s]==e)return r[s]==t;n.push(e),r.push(t);var o=0,u=!0;if(i=="[object Array]"){o=e.length,u=o==t.length;if(u)while(o--)if(!(u=O(e[o],t[o],n,r)))break}else{var a=e.constructor,l=t.constructor;if(a!==l&&!(x.isFunction(a)&&a instanceof a&&x.isFunction(l)&&l instanceof l))return!1;for(var c in e)if(x.has(e,c)){o++;if(!(u=x.has(t,c)&&O(e[c],t[c],n,r)))break}if(u){for(c in t)if(x.has(t,c)&&!(o--))break;u=!o}}return n.pop(),r.pop(),u};x.isEqual=function(e,t){return O(e,t,[],[])},x.isEmpty=function(e){if(e==null)return!0;if(x.isArray(e)||x.isString(e))return e.length===0;for(var t in e)if(x.has(e,t))return!1;return!0},x.isElement=function(e){return!!e&&e.nodeType===1},x.isArray=w||function(e){return f.call(e)=="[object Array]"},x.isObject=function(e){return e===Object(e)},T(["Arguments","Function","String","Number","Date","RegExp"],function(e){x["is"+e]=function(t){return f.call(t)=="[object "+e+"]"}}),x.isArguments(arguments)||(x.isArguments=function(e){return!!e&&!!x.has(e,"callee")}),typeof /./!="function"&&(x.isFunction=function(e){return typeof e=="function"}),x.isFinite=function(e){return isFinite(e)&&!isNaN(parseFloat(e))},x.isNaN=function(e){return x.isNumber(e)&&e!=+e},x.isBoolean=function(e){return e===!0||e===!1||f.call(e)=="[object Boolean]"},x.isNull=function(e){return e===null},x.isUndefined=function(e){return e===void 0},x.has=function(e,t){return l.call(e,t)},x.noConflict=function(){return e._=t,this},x.identity=function(e){return e},x.times=function(e,t,n){var r=Array(e);for(var i=0;i<e;i++)r[i]=t.call(n,i);return r},x.random=function(e,t){return t==null&&(t=e,e=0),e+Math.floor(Math.random()*(t-e+1))};var M={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"}};M.unescape=x.invert(M.escape);var _={escape:new RegExp("["+x.keys(M.escape).join("")+"]","g"),unescape:new RegExp("("+x.keys(M.unescape).join("|")+")","g")};x.each(["escape","unescape"],function(e){x[e]=function(t){return t==null?"":(""+t).replace(_[e],function(t){return M[e][t]})}}),x.result=function(e,t){if(e==null)return null;var n=e[t];return x.isFunction(n)?n.call(e):n},x.mixin=function(e){T(x.functions(e),function(t){var n=x[t]=e[t];x.prototype[t]=function(){var e=[this._wrapped];return o.apply(e,arguments),j.call(this,n.apply(x,e))}})};var D=0;x.uniqueId=function(e){var t=++D+"";return e?e+t:t},x.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var P=/(.)^/,H={"'":"'","\\":"\\","\r":"r","\n":"n","	":"t","\u2028":"u2028","\u2029":"u2029"},B=/\\|'|\r|\n|\t|\u2028|\u2029/g;x.template=function(e,t,n){var r;n=x.defaults({},n,x.templateSettings);var i=new RegExp([(n.escape||P).source,(n.interpolate||P).source,(n.evaluate||P).source].join("|")+"|$","g"),s=0,o="__p+='";e.replace(i,function(t,n,r,i,u){return o+=e.slice(s,u).replace(B,function(e){return"\\"+H[e]}),n&&(o+="'+\n((__t=("+n+"))==null?'':_.escape(__t))+\n'"),r&&(o+="'+\n((__t=("+r+"))==null?'':__t)+\n'"),i&&(o+="';\n"+i+"\n__p+='"),s=u+t.length,t}),o+="';\n",n.variable||(o="with(obj||{}){\n"+o+"}\n"),o="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+o+"return __p;\n";try{r=new Function(n.variable||"obj","_",o)}catch(u){throw u.source=o,u}if(t)return r(t,x);var a=function(e){return r.call(this,e,x)};return a.source="function("+(n.variable||"obj")+"){\n"+o+"}",a},x.chain=function(e){return x(e).chain()};var j=function(e){return this._chain?x(e).chain():e};x.mixin(x),T(["pop","push","reverse","shift","sort","splice","unshift"],function(e){var t=r[e];x.prototype[e]=function(){var n=this._wrapped;return t.apply(n,arguments),(e=="shift"||e=="splice")&&n.length===0&&delete n[0],j.call(this,n)}}),T(["concat","join","slice"],function(e){var t=r[e];x.prototype[e]=function(){return j.call(this,t.apply(this._wrapped,arguments))}}),x.extend(x.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}})}.call(this),define("underscore",function(e){return function(){var t,n;return t||e._}}(this)),typeof JSON!="object"&&(JSON={}),function(){function f(e){return e<10?"0"+e:e}function quote(e){return escapable.lastIndex=0,escapable.test(e)?'"'+e.replace(escapable,function(e){var t=meta[e];return typeof t=="string"?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function str(e,t){var n,r,i,s,o=gap,u,a=t[e];a&&typeof a=="object"&&typeof a.toJSON=="function"&&(a=a.toJSON(e)),typeof rep=="function"&&(a=rep.call(t,e,a));switch(typeof a){case"string":return quote(a);case"number":return isFinite(a)?String(a):"null";case"boolean":case"null":return String(a);case"object":if(!a)return"null";gap+=indent,u=[];if(Object.prototype.toString.apply(a)==="[object Array]"){s=a.length;for(n=0;n<s;n+=1)u[n]=str(n,a)||"null";return i=u.length===0?"[]":gap?"[\n"+gap+u.join(",\n"+gap)+"\n"+o+"]":"["+u.join(",")+"]",gap=o,i}if(rep&&typeof rep=="object"){s=rep.length;for(n=0;n<s;n+=1)typeof rep[n]=="string"&&(r=rep[n],i=str(r,a),i&&u.push(quote(r)+(gap?": ":":")+i))}else for(r in a)Object.prototype.hasOwnProperty.call(a,r)&&(i=str(r,a),i&&u.push(quote(r)+(gap?": ":":")+i));return i=u.length===0?"{}":gap?"{\n"+gap+u.join(",\n"+gap)+"\n"+o+"}":"{"+u.join(",")+"}",gap=o,i}}typeof Date.prototype.toJSON!="function"&&(Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()});var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;typeof JSON.stringify!="function"&&(JSON.stringify=function(e,t,n){var r;gap="",indent="";if(typeof n=="number")for(r=0;r<n;r+=1)indent+=" ";else typeof n=="string"&&(indent=n);rep=t;if(!t||typeof t=="function"||typeof t=="object"&&typeof t.length=="number")return str("",{"":e});throw new Error("JSON.stringify")}),typeof JSON.parse!="function"&&(JSON.parse=function(text,reviver){function walk(e,t){var n,r,i=e[t];if(i&&typeof i=="object")for(n in i)Object.prototype.hasOwnProperty.call(i,n)&&(r=walk(i,n),r!==undefined?i[n]=r:delete i[n]);return reviver.call(e,t,i)}var j;text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)}));if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),typeof reviver=="function"?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})}(),define("json2",function(){}),function(){var e=this,t=e.Backbone,n=[],r=n.push,i=n.slice,s=n.splice,o;typeof exports!="undefined"?o=exports:o=e.Backbone={},o.VERSION="1.0.0";var u=e._;!u&&typeof require!="undefined"&&(u=require("underscore")),o.$=e.jQuery||e.Zepto||e.ender||e.$,o.noConflict=function(){return e.Backbone=t,this},o.emulateHTTP=!1,o.emulateJSON=!1;var a=o.Events={on:function(e,t,n){if(!l(this,"on",e,[t,n])||!t)return this;this._events||(this._events={});var r=this._events[e]||(this._events[e]=[]);return r.push({callback:t,context:n,ctx:n||this}),this},once:function(e,t,n){if(!l(this,"once",e,[t,n])||!t)return this;var r=this,i=u.once(function(){r.off(e,i),t.apply(this,arguments)});return i._callback=t,this.on(e,i,n)},off:function(e,t,n){var r,i,s,o,a,f,c,h;if(!this._events||!l(this,"off",e,[t,n]))return this;if(!e&&!t&&!n)return this._events={},this;o=e?[e]:u.keys(this._events);for(a=0,f=o.length;a<f;a++){e=o[a];if(s=this._events[e]){this._events[e]=r=[];if(t||n)for(c=0,h=s.length;c<h;c++)i=s[c],(t&&t!==i.callback&&t!==i.callback._callback||n&&n!==i.context)&&r.push(i);r.length||delete this._events[e]}}return this},trigger:function(e){if(!this._events)return this;var t=i.call(arguments,1);if(!l(this,"trigger",e,t))return this;var n=this._events[e],r=this._events.all;return n&&c(n,t),r&&c(r,arguments),this},stopListening:function(e,t,n){var r=this._listeners;if(!r)return this;var i=!t&&!n;typeof t=="object"&&(n=this),e&&((r={})[e._listenerId]=e);for(var s in r)r[s].off(t,n,this),i&&delete this._listeners[s];return this}},f=/\s+/,l=function(e,t,n,r){if(!n)return!0;if(typeof n=="object"){for(var i in n)e[t].apply(e,[i,n[i]].concat(r));return!1}if(f.test(n)){var s=n.split(f);for(var o=0,u=s.length;o<u;o++)e[t].apply(e,[s[o]].concat(r));return!1}return!0},c=function(e,t){var n,r=-1,i=e.length,s=t[0],o=t[1],u=t[2];switch(t.length){case 0:while(++r<i)(n=e[r]).callback.call(n.ctx);return;case 1:while(++r<i)(n=e[r]).callback.call(n.ctx,s);return;case 2:while(++r<i)(n=e[r]).callback.call(n.ctx,s,o);return;case 3:while(++r<i)(n=e[r]).callback.call(n.ctx,s,o,u);return;default:while(++r<i)(n=e[r]).callback.apply(n.ctx,t)}},h={listenTo:"on",listenToOnce:"once"};u.each(h,function(e,t){a[t]=function(t,n,r){var i=this._listeners||(this._listeners={}),s=t._listenerId||(t._listenerId=u.uniqueId("l"));return i[s]=t,typeof n=="object"&&(r=this),t[e](n,r,this),this}}),a.bind=a.on,a.unbind=a.off,u.extend(o,a);var p=o.Model=function(e,t){var n,r=e||{};t||(t={}),this.cid=u.uniqueId("c"),this.attributes={},u.extend(this,u.pick(t,d)),t.parse&&(r=this.parse(r,t)||{});if(n=u.result(this,"defaults"))r=u.defaults({},r,n);this.set(r,t),this.changed={},this.initialize.apply(this,arguments)},d=["url","urlRoot","collection"];u.extend(p.prototype,a,{changed:null,validationError:null,idAttribute:"id",initialize:function(){},toJSON:function(e){return u.clone(this.attributes)},sync:function(){return o.sync.apply(this,arguments)},get:function(e){return this.attributes[e]},escape:function(e){return u.escape(this.get(e))},has:function(e){return this.get(e)!=null},set:function(e,t,n){var r,i,s,o,a,f,l,c;if(e==null)return this;typeof e=="object"?(i=e,n=t):(i={})[e]=t,n||(n={});if(!this._validate(i,n))return!1;s=n.unset,a=n.silent,o=[],f=this._changing,this._changing=!0,f||(this._previousAttributes=u.clone(this.attributes),this.changed={}),c=this.attributes,l=this._previousAttributes,this.idAttribute in i&&(this.id=i[this.idAttribute]);for(r in i)t=i[r],u.isEqual(c[r],t)||o.push(r),u.isEqual(l[r],t)?delete this.changed[r]:this.changed[r]=t,s?delete c[r]:c[r]=t;if(!a){o.length&&(this._pending=!0);for(var h=0,p=o.length;h<p;h++)this.trigger("change:"+o[h],this,c[o[h]],n)}if(f)return this;if(!a)while(this._pending)this._pending=!1,this.trigger("change",this,n);return this._pending=!1,this._changing=!1,this},unset:function(e,t){return this.set(e,void 0,u.extend({},t,{unset:!0}))},clear:function(e){var t={};for(var n in this.attributes)t[n]=void 0;return this.set(t,u.extend({},e,{unset:!0}))},hasChanged:function(e){return e==null?!u.isEmpty(this.changed):u.has(this.changed,e)},changedAttributes:function(e){if(!e)return this.hasChanged()?u.clone(this.changed):!1;var t,n=!1,r=this._changing?this._previousAttributes:this.attributes;for(var i in e){if(u.isEqual(r[i],t=e[i]))continue;(n||(n={}))[i]=t}return n},previous:function(e){return e==null||!this._previousAttributes?null:this._previousAttributes[e]},previousAttributes:function(){return u.clone(this._previousAttributes)},fetch:function(e){e=e?u.clone(e):{},e.parse===void 0&&(e.parse=!0);var t=this,n=e.success;return e.success=function(r){if(!t.set(t.parse(r,e),e))return!1;n&&n(t,r,e),t.trigger("sync",t,r,e)},j(this,e),this.sync("read",this,e)},save:function(e,t,n){var r,i,s,o=this.attributes;e==null||typeof e=="object"?(r=e,n=t):(r={})[e]=t;if(r&&(!n||!n.wait)&&!this.set(r,n))return!1;n=u.extend({validate:!0},n);if(!this._validate(r,n))return!1;r&&n.wait&&(this.attributes=u.extend({},o,r)),n.parse===void 0&&(n.parse=!0);var a=this,f=n.success;return n.success=function(e){a.attributes=o;var t=a.parse(e,n);n.wait&&(t=u.extend(r||{},t));if(u.isObject(t)&&!a.set(t,n))return!1;f&&f(a,e,n),a.trigger("sync",a,e,n)},j(this,n),i=this.isNew()?"create":n.patch?"patch":"update",i==="patch"&&(n.attrs=r),s=this.sync(i,this,n),r&&n.wait&&(this.attributes=o),s},destroy:function(e){e=e?u.clone(e):{};var t=this,n=e.success,r=function(){t.trigger("destroy",t,t.collection,e)};e.success=function(i){(e.wait||t.isNew())&&r(),n&&n(t,i,e),t.isNew()||t.trigger("sync",t,i,e)};if(this.isNew())return e.success(),!1;j(this,e);var i=this.sync("delete",this,e);return e.wait||r(),i},url:function(){var e=u.result(this,"urlRoot")||u.result(this.collection,"url")||B();return this.isNew()?e:e+(e.charAt(e.length-1)==="/"?"":"/")+encodeURIComponent(this.id)},parse:function(e,t){return e},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return this.id==null},isValid:function(e){return this._validate({},u.extend(e||{},{validate:!0}))},_validate:function(e,t){if(!t.validate||!this.validate)return!0;e=u.extend({},this.attributes,e);var n=this.validationError=this.validate(e,t)||null;return n?(this.trigger("invalid",this,n,u.extend(t||{},{validationError:n})),!1):!0}});var v=["keys","values","pairs","invert","pick","omit"];u.each(v,function(e){p.prototype[e]=function(){var t=i.call(arguments);return t.unshift(this.attributes),u[e].apply(u,t)}});var m=o.Collection=function(e,t){t||(t={}),t.url&&(this.url=t.url),t.model&&(this.model=t.model),t.comparator!==void 0&&(this.comparator=t.comparator),this._reset(),this.initialize.apply(this,arguments),e&&this.reset(e,u.extend({silent:!0},t))},g={add:!0,remove:!0,merge:!0},y={add:!0,merge:!1,remove:!1};u.extend(m.prototype,a,{model:p,initialize:function(){},toJSON:function(e){return this.map(function(t){return t.toJSON(e)})},sync:function(){return o.sync.apply(this,arguments)},add:function(e,t){return this.set(e,u.defaults(t||{},y))},remove:function(e,t){e=u.isArray(e)?e.slice():[e],t||(t={});var n,r,i,s;for(n=0,r=e.length;n<r;n++){s=this.get(e[n]);if(!s)continue;delete this._byId[s.id],delete this._byId[s.cid],i=this.indexOf(s),this.models.splice(i,1),this.length--,t.silent||(t.index=i,s.trigger("remove",s,this,t)),this._removeReference(s)}return this},set:function(e,t){t=u.defaults(t||{},g),t.parse&&(e=this.parse(e,t)),u.isArray(e)||(e=e?[e]:[]);var n,i,o,a,f,l,c=t.at,h=this.comparator&&c==null&&t.sort!==!1,p=u.isString(this.comparator)?this.comparator:null,d=[],v=[],m={};for(n=0,i=e.length;n<i;n++){if(!(o=this._prepareModel(e[n],t)))continue;(f=this.get(o))?(t.remove&&(m[f.cid]=!0),t.merge&&(f.set(o.attributes,t),h&&!l&&f.hasChanged(p)&&(l=!0))):t.add&&(d.push(o),o.on("all",this._onModelEvent,this),this._byId[o.cid]=o,o.id!=null&&(this._byId[o.id]=o))}if(t.remove){for(n=0,i=this.length;n<i;++n)m[(o=this.models[n]).cid]||v.push(o);v.length&&this.remove(v,t)}d.length&&(h&&(l=!0),this.length+=d.length,c!=null?s.apply(this.models,[c,0].concat(d)):r.apply(this.models,d)),l&&this.sort({silent:!0});if(t.silent)return this;for(n=0,i=d.length;n<i;n++)(o=d[n]).trigger("add",o,this,t);return l&&this.trigger("sort",this,t),this},reset:function(e,t){t||(t={});for(var n=0,r=this.models.length;n<r;n++)this._removeReference(this.models[n]);return t.previousModels=this.models,this._reset(),this.add(e,u.extend({silent:!0},t)),t.silent||this.trigger("reset",this,t),this},push:function(e,t){return e=this._prepareModel(e,t),this.add(e,u.extend({at:this.length},t)),e},pop:function(e){var t=this.at(this.length-1);return this.remove(t,e),t},unshift:function(e,t){return e=this._prepareModel(e,t),this.add(e,u.extend({at:0},t)),e},shift:function(e){var t=this.at(0);return this.remove(t,e),t},slice:function(e,t){return this.models.slice(e,t)},get:function(e){return e==null?void 0:this._byId[e.id!=null?e.id:e.cid||e]},at:function(e){return this.models[e]},where:function(e,t){return u.isEmpty(e)?t?void 0:[]:this[t?"find":"filter"](function(t){for(var n in e)if(e[n]!==t.get(n))return!1;return!0})},findWhere:function(e){return this.where(e,!0)},sort:function(e){if(!this.comparator)throw new Error("Cannot sort a set without a comparator");return e||(e={}),u.isString(this.comparator)||this.comparator.length===1?this.models=this.sortBy(this.comparator,this):this.models.sort(u.bind(this.comparator,this)),e.silent||this.trigger("sort",this,e),this},sortedIndex:function(e,t,n){t||(t=this.comparator);var r=u.isFunction(t)?t:function(e){return e.get(t)};return u.sortedIndex(this.models,e,r,n)},pluck:function(e){return u.invoke(this.models,"get",e)},fetch:function(e){e=e?u.clone(e):{},e.parse===void 0&&(e.parse=!0);var t=e.success,n=this;return e.success=function(r){var i=e.reset?"reset":"set";n[i](r,e),t&&t(n,r,e),n.trigger("sync",n,r,e)},j(this,e),this.sync("read",this,e)},create:function(e,t){t=t?u.clone(t):{};if(!(e=this._prepareModel(e,t)))return!1;t.wait||this.add(e,t);var n=this,r=t.success;return t.success=function(i){t.wait&&n.add(e,t),r&&r(e,i,t)},e.save(null,t),e},parse:function(e,t){return e},clone:function(){return new this.constructor(this.models)},_reset:function(){this.length=0,this.models=[],this._byId={}},_prepareModel:function(e,t){if(e instanceof p)return e.collection||(e.collection=this),e;t||(t={}),t.collection=this;var n=new this.model(e,t);return n._validate(e,t)?n:(this.trigger("invalid",this,e,t),!1)},_removeReference:function(e){this===e.collection&&delete e.collection,e.off("all",this._onModelEvent,this)},_onModelEvent:function(e,t,n,r){if((e==="add"||e==="remove")&&n!==this)return;e==="destroy"&&this.remove(t,r),t&&e==="change:"+t.idAttribute&&(delete this._byId[t.previous(t.idAttribute)],t.id!=null&&(this._byId[t.id]=t)),this.trigger.apply(this,arguments)}});var b=["forEach","each","map","collect","reduce","foldl","inject","reduceRight","foldr","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","toArray","size","first","head","take","initial","rest","tail","drop","last","without","indexOf","shuffle","lastIndexOf","isEmpty","chain"];u.each(b,function(e){m.prototype[e]=function(){var t=i.call(arguments);return t.unshift(this.models),u[e].apply(u,t)}});var w=["groupBy","countBy","sortBy"];u.each(w,function(e){m.prototype[e]=function(t,n){var r=u.isFunction(t)?t:function(e){return e.get(t)};return u[e](this.models,r,n)}});var E=o.View=function(e){this.cid=u.uniqueId("view"),this._configure(e||{}),this._ensureElement(),this.initialize.apply(this,arguments),this.delegateEvents()},S=/^(\S+)\s*(.*)$/,x=["model","collection","el","id","attributes","className","tagName","events"];u.extend(E.prototype,a,{tagName:"div",$:function(e){return this.$el.find(e)},initialize:function(){},render:function(){return this},remove:function(){return this.$el.remove(),this.stopListening(),this},setElement:function(e,t){return this.$el&&this.undelegateEvents(),this.$el=e instanceof o.$?e:o.$(e),this.el=this.$el[0],t!==!1&&this.delegateEvents(),this},delegateEvents:function(e){if(!e&&!(e=u.result(this,"events")))return this;this.undelegateEvents();for(var t in e){var n=e[t];u.isFunction(n)||(n=this[e[t]]);if(!n)continue;var r=t.match(S),i=r[1],s=r[2];n=u.bind(n,this),i+=".delegateEvents"+this.cid,s===""?this.$el.on(i,n):this.$el.on(i,s,n)}return this},undelegateEvents:function(){return this.$el.off(".delegateEvents"+this.cid),this},_configure:function(e){this.options&&(e=u.extend({},u.result(this,"options"),e)),u.extend(this,u.pick(e,x)),this.options=e},_ensureElement:function(){if(!this.el){var e=u.extend({},u.result(this,"attributes"));this.id&&(e.id=u.result(this,"id")),this.className&&(e["class"]=u.result(this,"className"));var t=o.$("<"+u.result(this,"tagName")+">").attr(e);this.setElement(t,!1)}else this.setElement(u.result(this,"el"),!1)}}),o.sync=function(e,t,n){var r=T[e];u.defaults(n||(n={}),{emulateHTTP:o.emulateHTTP,emulateJSON:o.emulateJSON});var i={type:r,dataType:"json"};n.url||(i.url=u.result(t,"url")||B()),n.data==null&&t&&(e==="create"||e==="update"||e==="patch")&&(i.contentType="application/json",i.data=JSON.stringify(n.attrs||t.toJSON(n))),n.emulateJSON&&(i.contentType="application/x-www-form-urlencoded",i.data=i.data?{model:i.data}:{});if(n.emulateHTTP&&(r==="PUT"||r==="DELETE"||r==="PATCH")){i.type="POST",n.emulateJSON&&(i.data._method=r);var s=n.beforeSend;n.beforeSend=function(e){e.setRequestHeader("X-HTTP-Method-Override",r);if(s)return s.apply(this,arguments)}}i.type!=="GET"&&!n.emulateJSON&&(i.processData=!1),i.type==="PATCH"&&window.ActiveXObject&&(!window.external||!window.external.msActiveXFilteringEnabled)&&(i.xhr=function(){return new ActiveXObject("Microsoft.XMLHTTP")});var a=n.xhr=o.ajax(u.extend(i,n));return t.trigger("request",t,a,n),a};var T={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",read:"GET"};o.ajax=function(){return o.$.ajax.apply(o.$,arguments)};var N=o.Router=function(e){e||(e={}),e.routes&&(this.routes=e.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},C=/\((.*?)\)/g,k=/(\(\?)?:\w+/g,L=/\*\w+/g,A=/[\-{}\[\]+?.,\\\^$|#\s]/g;u.extend(N.prototype,a,{initialize:function(){},route:function(e,t,n){u.isRegExp(e)||(e=this._routeToRegExp(e)),u.isFunction(t)&&(n=t,t=""),n||(n=this[t]);var r=this;return o.history.route(e,function(i){var s=r._extractParameters(e,i);n&&n.apply(r,s),r.trigger.apply(r,["route:"+t].concat(s)),r.trigger("route",t,s),o.history.trigger("route",r,t,s)}),this},navigate:function(e,t){return o.history.navigate(e,t),this},_bindRoutes:function(){if(!this.routes)return;this.routes=u.result(this,"routes");var e,t=u.keys(this.routes);while((e=t.pop())!=null)this.route(e,this.routes[e])},_routeToRegExp:function(e){return e=e.replace(A,"\\$&").replace(C,"(?:$1)?").replace(k,function(e,t){return t?e:"([^/]+)"}).replace(L,"(.*?)"),new RegExp("^"+e+"$")},_extractParameters:function(e,t){var n=e.exec(t).slice(1);return u.map(n,function(e){return e?decodeURIComponent(e):null})}});var O=o.History=function(){this.handlers=[],u.bindAll(this,"checkUrl"),typeof window!="undefined"&&(this.location=window.location,this.history=window.history)},M=/^[#\/]|\s+$/g,_=/^\/+|\/+$/g,D=/msie [\w.]+/,P=/\/$/;O.started=!1,u.extend(O.prototype,a,{interval:50,getHash:function(e){var t=(e||this).location.href.match(/#(.*)$/);return t?t[1]:""},getFragment:function(e,t){if(e==null)if(this._hasPushState||!this._wantsHashChange||t){e=this.location.pathname;var n=this.root.replace(P,"");e.indexOf(n)||(e=e.substr(n.length))}else e=this.getHash();return e.replace(M,"")},start:function(e){if(O.started)throw new Error("Backbone.history has already been started");O.started=!0,this.options=u.extend({},{root:"/"},this.options,e),this.root=this.options.root,this._wantsHashChange=this.options.hashChange!==!1,this._wantsPushState=!!this.options.pushState,this._hasPushState=!!(this.options.pushState&&this.history&&this.history.pushState);var t=this.getFragment(),n=document.documentMode,r=D.exec(navigator.userAgent.toLowerCase())&&(!n||n<=7);this.root=("/"+this.root+"/").replace(_,"/"),r&&this._wantsHashChange&&(this.iframe=o.$('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow,this.navigate(t)),this._hasPushState?o.$(window).on("popstate",this.checkUrl):this._wantsHashChange&&"onhashchange"in window&&!r?o.$(window).on("hashchange",this.checkUrl):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),this.fragment=t;var i=this.location,s=i.pathname.replace(/[^\/]$/,"$&/")===this.root;if(this._wantsHashChange&&this._wantsPushState&&!this._hasPushState&&!s)return this.fragment=this.getFragment(null,!0),this.location.replace(this.root+this.location.search+"#"+this.fragment),!0;this._wantsPushState&&this._hasPushState&&s&&i.hash&&(this.fragment=this.getHash().replace(M,""),this.history.replaceState({},document.title,this.root+this.fragment+i.search));if(!this.options.silent)return this.loadUrl()},stop:function(){o.$(window).off("popstate",this.checkUrl).off("hashchange",this.checkUrl),clearInterval(this._checkUrlInterval),O.started=!1},route:function(e,t){this.handlers.unshift({route:e,callback:t})},checkUrl:function(e){var t=this.getFragment();t===this.fragment&&this.iframe&&(t=this.getFragment(this.getHash(this.iframe)));if(t===this.fragment)return!1;this.iframe&&this.navigate(t),this.loadUrl()||this.loadUrl(this.getHash())},loadUrl:function(e){var t=this.fragment=this.getFragment(e),n=u.any(this.handlers,function(e){if(e.route.test(t))return e.callback(t),!0});return n},navigate:function(e,t){if(!O.started)return!1;if(!t||t===!0)t={trigger:t};e=this.getFragment(e||"");if(this.fragment===e)return;this.fragment=e;var n=this.root+e;if(this._hasPushState)this.history[t.replace?"replaceState":"pushState"]({},document.title,n);else{if(!this._wantsHashChange)return this.location.assign(n);this._updateHash(this.location,e,t.replace),this.iframe&&e!==this.getFragment(this.getHash(this.iframe))&&(t.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,e,t.replace))}t.trigger&&this.loadUrl(e)},_updateHash:function(e,t,n){if(n){var r=e.href.replace(/(javascript:|#).*$/,"");e.replace(r+"#"+t)}else e.hash="#"+t}}),o.history=new O;var H=function(e,t){var n=this,r;e&&u.has(e,"constructor")?r=e.constructor:r=function(){return n.apply(this,arguments)},u.extend(r,n,t);var i=function(){this.constructor=r};return i.prototype=n.prototype,r.prototype=new i,e&&u.extend(r.prototype,e),r.__super__=n.prototype,r};p.extend=m.extend=N.extend=E.extend=O.extend=H;var B=function(){throw new Error('A "url" property or function must be specified')},j=function(e,t){var n=t.error;t.error=function(r){n&&n(e,r,t),e.trigger("error",e,r,t)}}}.call(this),define("backbone",["json2","underscore"],function(e){return function(){var t,n;return t||e.Backbone}}(this)),function(e,t){if(typeof exports=="object"){var n=require("underscore"),r=require("backbone");module.exports=t(n,r)}else typeof define=="function"&&define.amd&&define("backbone.wreqr",["underscore","backbone"],t)}(this,function(e,t){return t.Wreqr=function(e,t,n){var r={};return r.Handlers=function(e,t){var n=function(e){this.options=e,this._wreqrHandlers={},t.isFunction(this.initialize)&&this.initialize(e)};return n.extend=e.Model.extend,t.extend(n.prototype,e.Events,{setHandlers:function(e){t.each(e,function(e,n){var r=null;t.isObject(e)&&!t.isFunction(e)&&(r=e.context,e=e.callback),this.setHandler(n,e,r)},this)},setHandler:function(e,t,n){var r={callback:t,context:n};this._wreqrHandlers[e]=r,this.trigger("handler:add",e,t,n)},hasHandler:function(e){return!!this._wreqrHandlers[e]},getHandler:function(e){var t=this._wreqrHandlers[e];if(!t)throw new Error("Handler not found for '"+e+"'");return function(){var e=Array.prototype.slice.apply(arguments);return t.callback.apply(t.context,e)}},removeHandler:function(e){delete this._wreqrHandlers[e]},removeAllHandlers:function(){this._wreqrHandlers={}}}),n}(e,n),r.CommandStorage=function(){var t=function(e){this.options=e,this._commands={},n.isFunction(this.initialize)&&this.initialize(e)};return n.extend(t.prototype,e.Events,{getCommands:function(e){var t=this._commands[e];return t||(t={command:e,instances:[]},this._commands[e]=t),t},addCommand:function(e,t){var n=this.getCommands(e);n.instances.push(t)},clearCommands:function(e){var t=this.getCommands(e);t.instances=[]}}),t}(),r.Commands=function(e){return e.Handlers.extend({storageType:e.CommandStorage,constructor:function(t){this.options=t||{},this._initializeStorage(this.options),this.on("handler:add",this._executeCommands,this);var n=Array.prototype.slice.call(arguments);e.Handlers.prototype.constructor.apply(this,n)},execute:function(e,t){e=arguments[0],t=Array.prototype.slice.call(arguments,1),this.hasHandler(e)?this.getHandler(e).apply(this,t):this.storage.addCommand(e,t)},_executeCommands:function(e,t,r){var i=this.storage.getCommands(e);n.each(i.instances,function(e){t.apply(r,e)}),this.storage.clearCommands(e)},_initializeStorage:function(e){var t,r=e.storageType||this.storageType;n.isFunction(r)?t=new r:t=r,this.storage=t}})}(r),r.RequestResponse=function(e){return e.Handlers.extend({request:function(){var e=arguments[0],t=Array.prototype.slice.call(arguments,1);return this.getHandler(e).apply(this,t)}})}(r),r.EventAggregator=function(e,t){var n=function(){};return n.extend=e.Model.extend,t.extend(n.prototype,e.Events),n}(e,n),r}(t,t.Marionette,e),t.Wreqr}),function(e,t){if(typeof exports=="object"){var n=require("underscore"),r=require("backbone");module.exports=t(n,r)}else typeof define=="function"&&define.amd&&define("backbone.babysitter",["underscore","backbone"],t)}(this,function(e,t){"option strict";return t.ChildViewContainer=function(e,t){var n=function(e){this._views={},this._indexByModel={},this._indexByCustom={},this._updateLength(),t.each(e,this.add,this)};t.extend(n.prototype,{add:function(e,t){var n=e.cid;this._views[n]=e,e.model&&(this._indexByModel[e.model.cid]=n),t&&(this._indexByCustom[t]=n),this._updateLength()},findByModel:function(e){return this.findByModelCid(e.cid)},findByModelCid:function(e){var t=this._indexByModel[e];return this.findByCid(t)},findByCustom:function(e){var t=this._indexByCustom[e];return this.findByCid(t)},findByIndex:function(e){return t.values(this._views)[e]},findByCid:function(e){return this._views[e]},remove:function(e){var n=e.cid;e.model&&delete this._indexByModel[e.model.cid],t.any(this._indexByCustom,function(e,t){if(e===n)return delete this._indexByCustom[t],!0},this),delete this._views[n],this._updateLength()},call:function(e){this.apply(e,t.tail(arguments))},apply:function(e,n){t.each(this._views,function(r){t.isFunction(r[e])&&r[e].apply(r,n||[])})},_updateLength:function(){this.length=t.size(this._views)}});var r=["forEach","each","map","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","toArray","first","initial","rest","last","without","isEmpty","pluck"];return t.each(r,function(e){n.prototype[e]=function(){var n=t.values(this._views),r=[n].concat(t.toArray(arguments));return t[e].apply(t,r)}}),n}(t,e),t.ChildViewContainer}),function(e,t){if(typeof exports=="object"){var n=require("underscore"),r=require("backbone"),i=require("backbone.wreqr"),s=require("backbone.babysitter");module.exports=t(n,r,i,s)}else typeof define=="function"&&define.amd&&define("marionette",["underscore","backbone","backbone.wreqr","backbone.babysitter"],t)}(this,function(e,t){var n=function(e,t,n){function s(e){return i.call(e)}function o(e,t){var n=new Error(e);throw n.name=t||"Error",n}var r={};t.Marionette=r,r.$=t.$;var i=Array.prototype.slice;return r.extend=t.Model.extend,r.getOption=function(e,t){if(!e||!t)return;var n;return e.options&&t in e.options&&e.options[t]!==undefined?n=e.options[t]:n=e[t],n},r.triggerMethod=function(){function t(e,t,n){return n.toUpperCase()}var e=/(^|:)(\w)/gi,r=function(r){var i="on"+r.replace(e,t),s=this[i];this.trigger.apply(this,arguments);if(n.isFunction(s))return s.apply(this,n.tail(arguments))};return r}(),r.MonitorDOMRefresh=function(){function e(e){e._isShown=!0,r(e)}function t(e){e._isRendered=!0,r(e)}function r(e){e._isShown&&e._isRendered&&n.isFunction(e.triggerMethod)&&e.triggerMethod("dom:refresh")}return function(n){n.listenTo(n,"show",function(){e(n)}),n.listenTo(n,"render",function(){t(n)})}}(),function(e){function t(e,t,r,i){var s=i.split(/\s+/);n.each(s,function(n){var i=e[n];i||o("Method '"+n+"' was configured as an event handler, but does not exist."),e.listenTo(t,r,i,e)})}function r(e,t,n,r){e.listenTo(t,n,r,e)}function i(e,t,r,i){var s=i.split(/\s+/);n.each(s,function(n){var i=e[n];e.stopListening(t,r,i,e)})}function s(e,t,n,r){e.stopListening(t,n,r,e)}function u(e,t,r,i,s){if(!t||!r)return;n.isFunction(r)&&(r=r.call(e)),n.each(r,function(r,o){n.isFunction(r)?i(e,t,o,r):s(e,t,o,r)})}e.bindEntityEvents=function(e,n,i){u(e,n,i,r,t)},e.unbindEntityEvents=function(e,t,n){u(e,t,n,s,i)}}(r),r.Callbacks=function(){this._deferred=r.$.Deferred(),this._callbacks=[]},n.extend(r.Callbacks.prototype,{add:function(e,t){this._callbacks.push({cb:e,ctx:t}),this._deferred.done(function(n,r){t&&(n=t),e.call(n,r)})},run:function(e,t){this._deferred.resolve(t,e)},reset:function(){var e=this._callbacks;this._deferred=r.$.Deferred(),this._callbacks=[],n.each(e,function(e){this.add(e.cb,e.ctx)},this)}}),r.Controller=function(e){this.triggerMethod=r.triggerMethod,this.options=e||{},n.isFunction(this.initialize)&&this.initialize(this.options)},r.Controller.extend=r.extend,n.extend(r.Controller.prototype,t.Events,{close:function(){this.stopListening(),this.triggerMethod("close"),this.unbind()}}),r.Region=function(e){this.options=e||{},this.el=r.getOption(this,"el");if(!this.el){var t=new Error("An 'el' must be specified for a region.");throw t.name="NoElError",t}if(this.initialize){var n=Array.prototype.slice.apply(arguments);this.initialize.apply(this,n)}},n.extend(r.Region,{buildRegion:function(e,t){var r=typeof e=="string",i=typeof e.selector=="string",s=typeof e.regionType=="undefined",o=typeof e=="function";if(!o&&!r&&!i)throw new Error("Region must be specified as a Region type, a selector string or an object with selector property");var u,a;r&&(u=e),e.selector&&(u=e.selector),o&&(a=e),!o&&s&&(a=t),e.regionType&&(a=e.regionType);var f=new a({el:u});return e.parentEl&&(f.getEl=function(t){var r=e.parentEl;return n.isFunction(r)&&(r=r()),r.find(t)}),f}}),n.extend(r.Region.prototype,t.Events,{show:function(e){this.ensureEl();var t=e.isClosed||n.isUndefined(e.$el),i=e!==this.currentView;i&&this.close(),e.render(),(i||t)&&this.open(e),this.currentView=e,r.triggerMethod.call(this,"show",e),r.triggerMethod.call(e,"show")},ensureEl:function(){if(!this.$el||this.$el.length===0)this.$el=this.getEl(this.el)},getEl:function(e){return r.$(e)},open:function(e){this.$el.empty().append(e.el)},close:function(){var e=this.currentView;if(!e||e.isClosed)return;e.close?e.close():e.remove&&e.remove(),r.triggerMethod.call(this,"close"),delete this.currentView},attachView:function(e){this.currentView=e},reset:function(){this.close(),delete this.$el}}),r.Region.extend=r.extend,r.RegionManager=function(e){var t=e.Controller.extend({constructor:function(t){this._regions={},e.Controller.prototype.constructor.call(this,t)},addRegions:function(e,t){var r={};return n.each(e,function(e,i){typeof e=="string"&&(e={selector:e}),e.selector&&(e=n.defaults({},e,t));var s=this.addRegion(i,e);r[i]=s},this),r},addRegion:function(t,r){var i,s=n.isObject(r),o=n.isString(r),u=!!r.selector;return o||s&&u?i=e.Region.buildRegion(r,e.Region):n.isFunction(r)?i=e.Region.buildRegion(r,e.Region):i=r,this._store(t,i),this.triggerMethod("region:add",t,i),i},get:function(e){return this._regions[e]},removeRegion:function(e){var t=this._regions[e];this._remove(e,t)},removeRegions:function(){n.each(this._regions,function(e,t){this._remove(t,e)},this)},closeRegions:function(){n.each(this._regions,function(e,t){e.close()},this)},close:function(){this.removeRegions();var t=Array.prototype.slice.call(arguments);e.Controller.prototype.close.apply(this,t)},_store:function(e,t){this._regions[e]=t,this._setLength()},_remove:function(e,t){t.close(),delete this._regions[e],this._setLength(),this.triggerMethod("region:remove",e,t)},_setLength:function(){this.length=n.size(this._regions)}}),r=["forEach","each","map","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","toArray","first","initial","rest","last","without","isEmpty","pluck"];return n.each(r,function(e){t.prototype[e]=function(){var t=n.values(this._regions),r=[t].concat(n.toArray(arguments));return n[e].apply(n,r)}}),t}(r),r.TemplateCache=function(e){this.templateId=e},n.extend(r.TemplateCache,{templateCaches:{},get:function(e){var t=this.templateCaches[e];return t||(t=new r.TemplateCache(e),this.templateCaches[e]=t),t.load()},clear:function(){var e,t=s(arguments),n=t.length;if(n>0)for(e=0;e<n;e++)delete this.templateCaches[t[e]];else this.templateCaches={}}}),n.extend(r.TemplateCache.prototype,{load:function(){if(this.compiledTemplate)return this.compiledTemplate;var e=this.loadTemplate(this.templateId);return this.compiledTemplate=this.compileTemplate(e),this.compiledTemplate},loadTemplate:function(e){var t=r.$(e).html();return(!t||t.length===0)&&o("Could not find template: '"+e+"'","NoTemplateError"),t},compileTemplate:function(e){return n.template(e)}}),r.Renderer={render:function(e,t){if(!e){var n=new Error("Cannot render the template since it's false, null or undefined.");throw n.name="TemplateNotFoundError",n}var i;return typeof e=="function"?i=e:i=r.TemplateCache.get(e),i(t)}},r.View=t.View.extend({constructor:function(){n.bindAll(this,"render");var e=Array.prototype.slice.apply(arguments);t.View.prototype.constructor.apply(this,e),r.MonitorDOMRefresh(this),this.listenTo(this,"show",this.onShowCalled,this)},triggerMethod:r.triggerMethod,getTemplate:function(){return r.getOption(this,"template")},mixinTemplateHelpers:function(e){e=e||{};var t=this.templateHelpers;return n.isFunction(t)&&(t=t.call(this)),n.extend(e,t)},configureTriggers:function(){if(!this.triggers)return;var e={},t=n.result(this,"triggers");return n.each(t,function(t,n){e[n]=function(e){e&&e.preventDefault&&e.preventDefault(),e&&e.stopPropagation&&e.stopPropagation();var n={view:this,model:this.model,collection:this.collection};this.triggerMethod(t,n)}},this),e},delegateEvents:function(e){this._delegateDOMEvents(e),r.bindEntityEvents(this,this.model,r.getOption(this,"modelEvents")),r.bindEntityEvents(this,this.collection,r.getOption(this,"collectionEvents"))},_delegateDOMEvents:function(e){e=e||this.events,n.isFunction(e)&&(e=e.call(this));var r={},i=this.configureTriggers();n.extend(r,e,i),t.View.prototype.delegateEvents.call(this,r)},undelegateEvents:function(){var e=Array.prototype.slice.call(arguments);t.View.prototype.undelegateEvents.apply(this,e),r.unbindEntityEvents(this,this.model,r.getOption(this,"modelEvents")),r.unbindEntityEvents(this,this.collection,r.getOption(this,"collectionEvents"))},onShowCalled:function(){},close:function(){if(this.isClosed)return;var e=this.triggerMethod("before:close");if(e===!1)return;this.isClosed=!0,this.triggerMethod("close"),this.unbindUIElements(),this.remove()},bindUIElements:function(){if(!this.ui)return;this._uiBindings||(this._uiBindings=this.ui);var e=n.result(this,"_uiBindings");this.ui={},n.each(n.keys(e),function(t){var n=e[t];this.ui[t]=this.$(n)},this)},unbindUIElements:function(){if(!this.ui)return;n.each(this.ui,function(e,t){delete this.ui[t]},this),this.ui=this._uiBindings,delete this._uiBindings}}),r.ItemView=r.View.extend({serializeData:function(){var e={};return this.model?e=this.model.toJSON():this.collection&&(e={items:this.collection.toJSON()}),e},render:function(){this.isClosed=!1,this.triggerMethod("before:render",this),this.triggerMethod("item:before:render",this);var e=this.serializeData();e=this.mixinTemplateHelpers(e);var t=this.getTemplate(),n=r.Renderer.render(t,e);return this.$el.html(n),this.bindUIElements(),this.triggerMethod("render",this),this.triggerMethod("item:rendered",this),this},close:function(){if(this.isClosed)return;this.triggerMethod("item:before:close"),r.View.prototype.close.apply(this,s(arguments)),this.triggerMethod("item:closed")}}),r.CollectionView=r.View.extend({itemViewEventPrefix:"itemview",constructor:function(e){this._initChildViewStorage(),r.View.prototype.constructor.apply(this,s(arguments)),this._initialEvents()},_initialEvents:function(){this.collection&&(this.listenTo(this.collection,"add",this.addChildView,this),this.listenTo(this.collection,"remove",this.removeItemView,this),this.listenTo(this.collection,"reset",this.render,this))},addChildView:function(e,t,n){this.closeEmptyView();var r=this.getItemView(e),i=this.collection.indexOf(e);this.addItemView(e,r,i)},onShowCalled:function(){this.children.each(function(e){r.triggerMethod.call(e,"show")})},triggerBeforeRender:function(){this.triggerMethod("before:render",this),this.triggerMethod("collection:before:render",this)},triggerRendered:function(){this.triggerMethod("render",this),this.triggerMethod("collection:rendered",this)},render:function(){return this.isClosed=!1,this.triggerBeforeRender(),this._renderChildren(),this.triggerRendered(),this},_renderChildren:function(){this.closeEmptyView(),this.closeChildren(),this.collection&&this.collection.length>0?this.showCollection():this.showEmptyView()},showCollection:function(){var e;this.collection.each(function(t,n){e=this.getItemView(t),this.addItemView(t,e,n)},this)},showEmptyView:function(){var e=r.getOption(this,"emptyView");if(e&&!this._showingEmptyView){this._showingEmptyView=!0;var n=new t.Model;this.addItemView(n,e,0)}},closeEmptyView:function(){this._showingEmptyView&&(this.closeChildren(),delete this._showingEmptyView)},getItemView:function(e){var t=r.getOption(this,"itemView");return t||o("An `itemView` must be specified","NoItemViewError"),t},addItemView:function(e,t,i){var s=r.getOption(this,"itemViewOptions");n.isFunction(s)&&(s=s.call(this,e,i));var o=this.buildItemView(e,t,s);this.addChildViewEventForwarding(o),this.triggerMethod("before:item:added",o),this.children.add(o),this.renderItemView(o,i),this._isShown&&r.triggerMethod.call(o,"show"),this.triggerMethod("after:item:added",o)},addChildViewEventForwarding:function(e){var t=r.getOption(this,"itemViewEventPrefix");this.listenTo(e,"all",function(){var n=s(arguments);n[0]=t+":"+n[0],n.splice(1,0,e),r.triggerMethod.apply(this,n)},this)},renderItemView:function(e,t){e.render(),this.appendHtml(this,e,t)},buildItemView:function(e,t,r){var i=n.extend({model:e},r);return new t(i)},removeItemView:function(e){var t=this.children.findByModel(e);this.removeChildView(t),this.checkEmpty()},removeChildView:function(e){e&&(this.stopListening(e),e.close?e.close():e.remove&&e.remove(),this.children.remove(e)),this.triggerMethod("item:removed",e)},checkEmpty:function(){(!this.collection||this.collection.length===0)&&this.showEmptyView()},appendHtml:function(e,t,n){e.$el.append(t.el)},_initChildViewStorage:function(){this.children=new t.ChildViewContainer},close:function(){if(this.isClosed)return;this.triggerMethod("collection:before:close"),this.closeChildren(),this.triggerMethod("collection:closed"),r.View.prototype.close.apply(this,s(arguments))},closeChildren:function(){this.children.each(function(e){this.removeChildView(e)},this),this.checkEmpty()}}),r.CompositeView=r.CollectionView.extend({_initialEvents:function(){this.collection&&(this.listenTo(this.collection,"add",this.addChildView,this),this.listenTo(this.collection,"remove",this.removeItemView,this),this.listenTo(this.collection,"reset",this._renderChildren,this))},getItemView:function(e){var t=r.getOption(this,"itemView")||this.constructor;return t||o("An `itemView` must be specified","NoItemViewError"),t},serializeData:function(){var e={};return this.model&&(e=this.model.toJSON()),e},render:function(){this.isRendered=!0,this.isClosed=!1,this.resetItemViewContainer(),this.triggerBeforeRender();var e=this.renderModel();return this.$el.html(e),this.bindUIElements(),this.triggerMethod("composite:model:rendered"),this._renderChildren(),this.triggerMethod("composite:rendered"),this.triggerRendered(),this},_renderChildren:function(){this.isRendered&&(r.CollectionView.prototype._renderChildren.call(this),this.triggerMethod("composite:collection:rendered"))},renderModel:function(){var e={};e=this.serializeData(),e=this.mixinTemplateHelpers(e);var t=this.getTemplate();return r.Renderer.render(t,e)},appendHtml:function(e,t,n){var r=this.getItemViewContainer(e);r.append(t.el)},getItemViewContainer:function(e){if("$itemViewContainer"in e)return e.$itemViewContainer;var t;if(e.itemViewContainer){var r=n.result(e,"itemViewContainer");t=e.$(r),t.length<=0&&o("The specified `itemViewContainer` was not found: "+e.itemViewContainer,"ItemViewContainerMissingError")}else t=e.$el;return e.$itemViewContainer=t,t},resetItemViewContainer:function(){this.$itemViewContainer&&delete this.$itemViewContainer}}),r.Layout=r.ItemView.extend({regionType:r.Region,constructor:function(e){e=e||{},this._firstRender=!0,this._initializeRegions(e),r.ItemView.call(this,e)},render:function(){this._firstRender?this._firstRender=!1:this.isClosed?this._initializeRegions():this._reInitializeRegions();var e=Array.prototype.slice.apply(arguments),t=r.ItemView.prototype.render.apply(this,e);return t},close:function(){if(this.isClosed)return;this.regionManager.close();var e=Array.prototype.slice.apply(arguments);r.ItemView.prototype.close.apply(this,e)},addRegion:function(e,t){var n={};return n[e]=t,this.addRegions(n)[e]},addRegions:function(e){return this.regions=n.extend(this.regions||{},e),this._buildRegions(e)},removeRegion:function(e){return this.regionManager.removeRegion(e)},_buildRegions:function(e){var t=this,n={parentEl:function(){return t.$el}};return this.regionManager.addRegions(e,n)},_initializeRegions:function(e){var t;this._initRegionManager(),n.isFunction(this.regions)?t=this.regions(e):t=this.regions||{},this.addRegions(t)},_reInitializeRegions:function(){this.regionManager.closeRegions(),this.regionManager.each(function(e){e.reset()})},_initRegionManager:function(){this.regionManager=new r.RegionManager,this.listenTo(this.regionManager,"region:add",function(e,t){this[e]=t,this.trigger("region:add",e,t)}),this.listenTo(this.regionManager,"region:remove",function(e,t){delete this[e],this.trigger("region:remove",e,t)})}}),r.AppRouter=t.Router.extend({constructor:function(e){t.Router.prototype.constructor.apply(this,s(arguments)),this.options=e;if(this.appRoutes){var n=r.getOption(this,"controller");this.processAppRoutes(n,this.appRoutes)}},processAppRoutes:function(e,t){var r=n.keys(t).reverse();n.each(r,function(r){var i=t[r],s=e[i];if(!s)throw new Error("Method '"+i+"' was not found on the controller");this.route(r,i,n.bind(s,e))},this)}}),r.Application=function(e){this._initRegionManager(),this._initCallbacks=new r.Callbacks,this.vent=new t.Wreqr.EventAggregator,this.commands=new t.Wreqr.Commands,this.reqres=new t.Wreqr.RequestResponse,this.submodules={},n.extend(this,e),this.triggerMethod=r.triggerMethod},n.extend(r.Application.prototype,t.Events,{execute:function(){var e=Array.prototype.slice.apply(arguments);this.commands.execute.apply(this.commands,e)},request:function(){var e=Array.prototype.slice.apply(arguments);return this.reqres.request.apply(this.reqres,e)},addInitializer:function(e){this._initCallbacks.add(e)},start:function(e){this.triggerMethod("initialize:before",e),this._initCallbacks.run(e,this),this.triggerMethod("initialize:after",e),this.triggerMethod("start",e)},addRegions:function(e){return this._regionManager.addRegions(e)},removeRegion:function(e){this._regionManager.removeRegion(e)},module:function(e,t){var n=s(arguments);return n.unshift(this),r.Module.create.apply(r.Module,n)},_initRegionManager:function(){this._regionManager=new r.RegionManager,this.listenTo(this._regionManager,"region:add",function(e,t){this[e]=t}),this.listenTo(this._regionManager,"region:remove",function(e,t){delete this[e]})}}),r.Application.extend=r.extend,r.Module=function(e,t){this.moduleName=e,this.submodules={},this._setupInitializersAndFinalizers(),this.app=t,this.startWithParent=!0,this.triggerMethod=r.triggerMethod},n.extend(r.Module.prototype,t.Events,{addInitializer:function(e){this._initializerCallbacks.add(e)},addFinalizer:function(e){this._finalizerCallbacks.add(e)},start:function(e){if(this._isInitialized)return;n.each(this.submodules,function(t){t.startWithParent&&t.start(e)}),this.triggerMethod("before:start",e),this._initializerCallbacks.run(e,this),this._isInitialized=!0,this.triggerMethod("start",e)},stop:function(){if(!this._isInitialized)return;this._isInitialized=!1,r.triggerMethod.call(this,"before:stop"),n.each(this.submodules,function(e){e.stop()}),this._finalizerCallbacks.run(undefined,this),this._initializerCallbacks.reset(),this._finalizerCallbacks.reset(),r.triggerMethod.call(this,"stop")},addDefinition:function(e,t){this._runModuleDefinition(e,t)},_runModuleDefinition:function(e,i){if(!e)return;var s=n.flatten([this,this.app,t,r,r.$,n,i]);e.apply(this,s)},_setupInitializersAndFinalizers:function(){this._initializerCallbacks=new r.Callbacks,this._finalizerCallbacks=new r.Callbacks}}),n.extend(r.Module,{create:function(e,t,r){var i=e,o=s(arguments);o.splice(0,3),t=t.split(".");var u=t.length,a=[];return a[u-1]=r,n.each(t,function(t,n){var r=i;i=this._getModule(r,t,e),this._addModuleDefinition(r,i,a[n],o)},this),i},_getModule:function(e,t,n,i,s){var o=e[t];return o||(o=new r.Module(t,n),e[t]=o,e.submodules[t]=o),o},_addModuleDefinition:function(e,t,r,i){var s,o;n.isFunction(r)?(s=r,o=!0):n.isObject(r)?(s=r.define,o=r.startWithParent):o=!0,s&&t.addDefinition(s,i),t.startWithParent=t.startWithParent&&o,t.startWithParent&&!t.startWithParentIsConfigured&&(t.startWithParentIsConfigured=!0,e.addInitializer(function(e){t.startWithParent&&t.start(e)}))}}),r}(this,t,e);return t.Marionette}),function(e){typeof define=="function"&&define.amd?define("backbone.geppetto",["underscore","backbone"],e):e(_,Backbone)}(function(e,t){if(!t)throw"Please include Backbone before Geppetto";var n={};n.version="0.6.3",n.EVENT_CONTEXT_SHUTDOWN="Geppetto:contextShutdown";var r={};n.Context=function(i){this.options=i||{},this.parentContext=this.options.parentContext,this.vent={},e.extend(this.vent,t.Events),e.isFunction(this.initialize)&&this.initialize.apply(this,arguments),this._contextId=e.uniqueId("Context"),r[this._contextId]=this,this.mapCommands()},n.bindContext=function(n){this.options=n||{};var r=this.options.view,i=null;return typeof this.options.context=="function"?(i=new this.options.context(this.options),r.close||(r.close=function(){r.trigger("close"),r.remove()}),r.on("close",function(){r.off("close"),i.unmapAll()})):typeof this.options.context=="object"&&(i=this.options.context),r.context=i,e.each(r.contextEvents,function(t,n){e.isFunction(t)?i.listen(r,n,t):e.isString(t)&&i.listen(r,n,r[t])}),i},n.Context.prototype.listen=function(n,r,i){if(arguments.length!==3)throw"Expected 3 arguments (target, eventName, callback)";if(!e.isObject(n)||!e.isFunction(n.listenTo)||!e.isFunction(n.stopListening))throw"Target for listen() must define a 'listenTo' and 'stopListening' function";if(!e.isString(r))throw"eventName must be a String";if(!e.isFunction(i))throw"callback must be a function";return n.listenTo(this.vent,r,i,n)},n.Context.prototype.dispatch=function(n,r){if(!e.isUndefined(r)&&!e.isObject(r))throw"Event payload must be an object";r=r||{},r.eventName=n,this.vent.trigger(n,r)},n.Context.prototype.dispatchToParent=function(t,n){this.parentContext&&this.parentContext.vent.trigger(t,n)},n.Context.prototype.dispatchGlobally=function(n,i){e.each(r,function(e,t){e.vent.trigger(n,i)})},n.Context.prototype.mapCommand=function(n,r){var i=this;if(!e.isFunction(r))throw"Command must be constructable";this.vent.listenTo(this.vent,n,function(t){var s=new r;s.context=i,s.eventName=n,s.eventData=t,e.isFunction(s.execute)&&s.execute()},this)},n.Context.prototype.mapCommands=function(){var n=this;e.each(this.commands,function(t,r){e.isArray(t)?e.each(t,function(e){n.mapCommand(r,e)}):n.mapCommand(r,t)})},n.Context.prototype.unmapAll=function(){this.vent.stopListening(),delete r[this._contextId],this.dispatchToParent(n.EVENT_CONTEXT_SHUTDOWN)},n.Context.extend=t.View.extend;var i={contexts:r,countEvents:function(){var n=0;return e.each(r,function(t,i){r.hasOwnProperty(i)&&(n+=e.size(t.vent._events))}),n},countContexts:function(){var n=0;return e.each(r,function(e,t){r.hasOwnProperty(t)&&n++}),n}};return n.setDebug=function(t){return t?this.debug=i:this.debug=undefined,this.debug},t.Geppetto=n,n}),define("commands/BootstrapRouterCommand",["backbone"],function(e){var t=e.Router.extend({routes:{"":"list","articles/:article":"show","articles/:article/":"show","notes/:note":"show","notes/:note/":"show","talks/:talk":"show","talks/:talk/":"show","projects/:project":"show","projects/:project/":"show"},goToDetail:function(e){var t;switch(e.get("type")){case"article":t="articles";break;case"note":t="notes";break;case"talk":t="talks";break;case"project":t="projects";break;default:t="post"}this.navigate(t+"/"+e.id,{trigger:!0}),document.title=e.get("title")+" - TOON.IO"}}),n=function(){};return _.extend(n.prototype,{execute:function(){this.initializeRouter()},initializeRouter:function(){this.context.router=new t,this.context.router.on("route",function(e,t){$("body").animate({scrollTop:0},"fast"),this.context.currentAction=e,e==="show"&&(this.context.currentDetail=t[0]),e==="list"&&(document.title="TOON.IO - Freelance JavaScript Developer"),this.context.dispatch("action:"+e,t)},this)}}),n}),define("models/node",["backbone"],function(e){var t=e.Model.extend({idAttribute:"alias"});return t}),define("collections/NodeCollection",["backbone","underscore","models/node"],function(e,t,n){var r=e.Collection.extend({model:n,url:"/node",comparator:function(e){return-1*e.get("createDateTimestamp")},initialize:function(e,t){this.context=t.context,this.context.currentDetail&&(this.current=this.get(this.context.currentDetail)),this.context.listen(this,"action:show",this.handleShow),this.context.listen(this,"action:list",this.resetPosition)},handleShow:function(e){this.current=this.get(this.context.currentDetail),this.currentPos=this.indexOf(this.current)},resetPosition:function(){this.currentPos=undefined},next:function(){this.currentPos===undefined?this.currentPos=0:this.currentPos=this.currentPos+1;if(this.currentPos<this.length-1)return this.current=this.at(this.currentPos),this.context.currentDetail=this.current.id,this.current;this.notifyFinal()},previous:function(){if(this.currentPos>0)return this.currentPos=this.currentPos-1,this.current=this.at(this.currentPos),this.context.currentDetail=this.current.id,this.current;this.currentPos!==undefined&&this.notifyFirst()},notifyFinal:t.debounce(function(){this.context.alertify.log("This is the last post",null,2e3),t.delay(this.context.alertify.log,1e3,'Press the "up" arrow to go the home overview',null,3e3)},1e3,!0),notifyFirst:t.debounce(function(){this.context.alertify.log("This is the first post",null,2e3),t.delay(this.context.alertify.log,1e3,'Press the "up" arrow to go the home overview',null,3e3)},1e3,!0)});return r}),define("text",["module"],function(e){var t,n,r,i,s,o=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],u=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,a=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,f=typeof location!="undefined"&&location.href,l=f&&location.protocol&&location.protocol.replace(/\:/,""),c=f&&location.hostname,h=f&&(location.port||undefined),p={},d=e.config&&e.config()||{};t={version:"2.0.10",strip:function(e){if(e){e=e.replace(u,"");var t=e.match(a);t&&(e=t[1])}else e="";return e},jsEscape:function(e){return e.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r").replace(/[\u2028]/g,"\\u2028").replace(/[\u2029]/g,"\\u2029")},createXhr:d.createXhr||function(){var e,t,n;if(typeof XMLHttpRequest!="undefined")return new XMLHttpRequest;if(typeof ActiveXObject!="undefined")for(t=0;t<3;t+=1){n=o[t];try{e=new ActiveXObject(n)}catch(r){}if(e){o=[n];break}}return e},parseName:function(e){var t,n,r,i=!1,s=e.indexOf("."),o=e.indexOf("./")===0||e.indexOf("../")===0;return s!==-1&&(!o||s>1)?(t=e.substring(0,s),n=e.substring(s+1,e.length)):t=e,r=n||t,s=r.indexOf("!"),s!==-1&&(i=r.substring(s+1)==="strip",r=r.substring(0,s),n?n=r:t=r),{moduleName:t,ext:n,strip:i}},xdRegExp:/^((\w+)\:)?\/\/([^\/\\]+)/,useXhr:function(e,n,r,i){var s,o,u,a=t.xdRegExp.exec(e);return a?(s=a[2],o=a[3],o=o.split(":"),u=o[1],o=o[0],(!s||s===n)&&(!o||o.toLowerCase()===r.toLowerCase())&&(!u&&!o||u===i)):!0},finishLoad:function(e,n,r,i){r=n?t.strip(r):r,d.isBuild&&(p[e]=r),i(r)},load:function(e,n,r,i){if(i.isBuild&&!i.inlineText){r();return}d.isBuild=i.isBuild;var s=t.parseName(e),o=s.moduleName+(s.ext?"."+s.ext:""),u=n.toUrl(o),a=d.useXhr||t.useXhr;if(u.indexOf("empty:")===0){r();return}!f||a(u,l,c,h)?t.get(u,function(n){t.finishLoad(e,s.strip,n,r)},function(e){r.error&&r.error(e)}):n([o],function(e){t.finishLoad(s.moduleName+"."+s.ext,s.strip,e,r)})},write:function(e,n,r,i){if(p.hasOwnProperty(n)){var s=t.jsEscape(p[n]);r.asModule(e+"!"+n,"define(function () { return '"+s+"';});\n")}},writeFile:function(e,n,r,i,s){var o=t.parseName(n),u=o.ext?"."+o.ext:"",a=o.moduleName+u,f=r.toUrl(o.moduleName+u)+".js";t.load(a,r,function(n){var r=function(e){return i(f,e)};r.asModule=function(e,t){return i.asModule(e,f,t)},t.write(e,a,r,s)},s)}};if(d.env==="node"||!d.env&&typeof process!="undefined"&&process.versions&&!!process.versions.node&&!process.versions["node-webkit"])n=require.nodeRequire("fs"),t.get=function(e,t,r){try{var i=n.readFileSync(e,"utf8");i.indexOf("﻿")===0&&(i=i.substring(1)),t(i)}catch(s){r(s)}};else if(d.env==="xhr"||!d.env&&t.createXhr())t.get=function(e,n,r,i){var s=t.createXhr(),o;s.open("GET",e,!0);if(i)for(o in i)i.hasOwnProperty(o)&&s.setRequestHeader(o.toLowerCase(),i[o]);d.onXhr&&d.onXhr(s,e),s.onreadystatechange=function(t){var i,o;s.readyState===4&&(i=s.status,i>399&&i<600?(o=new Error(e+" HTTP status: "+i),o.xhr=s,r(o)):n(s.responseText),d.onXhrComplete&&d.onXhrComplete(s,e))},s.send(null)};else if(d.env==="rhino"||!d.env&&typeof Packages!="undefined"&&typeof java!="undefined")t.get=function(e,t){var n,r,i="utf-8",s=new java.io.File(e),o=java.lang.System.getProperty("line.separator"),u=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(s),i)),a="";try{n=new java.lang.StringBuffer,r=u.readLine(),r&&r.length()&&r.charAt(0)===65279&&(r=r.substring(1)),r!==null&&n.append(r);while((r=u.readLine())!==null)n.append(o),n.append(r);a=String(n.toString())}finally{u.close()}t(a)};else if(d.env==="xpconnect"||!d.env&&typeof Components!="undefined"&&Components.classes&&Components.interfaces)r=Components.classes,i=Components.interfaces,Components.utils["import"]("resource://gre/modules/FileUtils.jsm"),s="@mozilla.org/windows-registry-key;1"in r,t.get=function(e,t){var n,o,u,a={};s&&(e=e.replace(/\//g,"\\")),u=new FileUtils.File(e);try{n=r["@mozilla.org/network/file-input-stream;1"].createInstance(i.nsIFileInputStream),n.init(u,1,0,!1),o=r["@mozilla.org/intl/converter-input-stream;1"].createInstance(i.nsIConverterInputStream),o.init(n,"utf-8",n.available(),i.nsIConverterInputStream.DEFAULT_REPLACEMENT_CHARACTER),o.readString(n.available(),a),o.close(),n.close(),t(a.value)}catch(f){throw new Error((u&&u.path||"")+": "+f)}};return t}),define("json",["text"],function(text){function cacheBust(e){return e=e.replace(CACHE_BUST_FLAG,""),e+=e.indexOf("?")<0?"?":"&",e+CACHE_BUST_QUERY_PARAM+"="+Math.round(2147483647*Math.random())}var CACHE_BUST_QUERY_PARAM="bust",CACHE_BUST_FLAG="!bust",jsonParse=typeof JSON!="undefined"&&typeof JSON.parse=="function"?JSON.parse:function(val){return eval("("+val+")")},buildMap={};return{load:function(e,t,n,r){!r.isBuild||r.inlineJSON!==!1&&e.indexOf(CACHE_BUST_QUERY_PARAM+"=")===-1?text.get(t.toUrl(e),function(t){r.isBuild?(buildMap[e]=t,n(t)):n(jsonParse(t))},n.error,{accept:"application/json"}):n(null)},normalize:function(e,t){return e.indexOf(CACHE_BUST_FLAG)!==-1&&(e=cacheBust(e)),t(e)},write:function(e,t,n){if(t in buildMap){var r=buildMap[t];n('define("'+e+"!"+t+'", function(){ return '+r+";});\n")}}}}),define("json!commands/../../../node/index.html",function(){return[{uuid:"8f8d85d9-7138-42c2-aa77-44dd78e4837b",author:"Toon Ketels",title:"Apps for Antwerp submisson: visualizing Antwerp's districts",alias:"apps-for-antwerp-visualizing-antwerps-districts",type:"article",tags:["d3js","visualization"],content:'<p>We submitted a small data-visualization app for Antwerp&#39;s first <a href="http://opendata.antwerpen.be/nieuws/apps-antwerp">Apps for Antwerp</a> event. A challenge for developers to come up with useful applications or visualizations using the city’s data.</p>\n<p>Our app visualized Antwerp&#39;s nine districts on different parameters. We settled on a minimal donut chart, <a href="http://knife-io.github.com/Apps-for-Antwerp/">see for yourself</a>.</p>\n<h2>A couple of principles that guided our design</h2>\n<h3>Incrementally display data</h3>\n<p>The visualization starts small with only a donut chart rolling out. By starting with a single item and incrementally adding items to the canvas one at a time, we guide the user&#39;s attention. The most important item is displayed first. Lesser items fade into the canvas later on.</p>\n<h3>Display little information to encourage user exploration</h3>\n<p>When everything has been displayed on the screen, only a disc and a form is displayed... nothing happens, not much information is conveyed. We do this to encourage users to start clicking around and exploring the graph themselves.</p>\n<h3>Remove all unnecessary information</h3>\n<p>Instead of using a map to display information, we chose a donut chart. This way, the user does not process unnecessary information like shape, location compared to other districts.</p>\n<p>All information has been stripped and the user can only digest information we want them to process.</p>\n<h3>Use movement to communicate change</h3>\n<p>By selecting different parameters, the area of a district will increase or decrease smoothly. We are hardwired to detect movement so it&#39;s easy to identify if something get&#39;s smaller or bigger.</p>\n<p>And because the user selects the parameters to change herself, she can select from what to what the movement occurs.</p>\n',teaser:'<p>We submitted a small data-visualization app for Antwerp&#39;s first <a href="http://opendata.antwerpen.be/nieuws/apps-antwerp">Apps for Antwerp</a> event. A challenge for developers to come up with useful applications or visualizations using the city’s data.</p>\n<p>Our ...</p>',createDate:"2012-12-16T00:00:00+01:00",updateDate:"2012-12-16T00:00:00+01:00",createDateFormatted:"2012.12.16",updateDateFormatted:"2012.12.16",createDateTimestamp:"1355612400",updateDateTimestamp:"1355612400"},{uuid:"b6da7dc5-57b5-4c19-b4e3-5b140df8b08e",author:"Toon Ketels",title:"Extend Fail2ban to send text messages every time a user/bot gets banned",alias:"fail2ban-send-sms-user-banned",type:"article",tags:["fail2ban","Twilio"],content:'<p>To prevent scripts from brute forcing their way into my VPS via SSH I use <a href="http://www.fail2ban.org">Fail2ban</a>. It&#39;s a tool that checks the logs for password failures and set IP rules that blocks that user&#39;s IP for a given time.</p>\n<p>I have it already set up to send emails (one of the default actions), but I wanted it to send me a text message every time an IP gets banned.</p>\n<p>Fail2ban does not ship with such an action. Fortunately, it&#39;s not hard to create one.</p>\n<h2>How to extend fail2ban with custom actions?</h2>\n<p>It&#39;s easy to extend Fail2ban with custom actions. You only need to do two things:\n1. Create a new action in the /etc/fail2/ban/actions.d directory\n2. Configure jail.local to use that action</p>\n<h2>Create new action in actions.d</h2>\n<p>The easiest way to create a new action is to copy dummy.conf to <em>new-action.conf</em> and edit it. You&#39;ll find the different &quot;hooks&quot; you can use to execute your commands. Variables are passed via &quot;&lt;variable&gt;&quot; syntax.</p>\n<p>Below you&#39;ll find my sms.conf.</p>\n<pre><code>#\n# Author: Toon Ketels\n#\n# $Revision$\n#\n\n[Definition]\n\n# Option:  actionstart\n# Notes.:  command executed once at the start of Fail2Ban.\n# Values:  CMD\n#\nactionstart = /home/all/scripts/fail2ban-sms.sh start\n\n# Option:  actionstop\n# Notes.:  command executed once at the end of Fail2Ban\n# Values:  CMD\n#\nactionstop = /home/all/scripts/fail2ban-sms.sh stop\n\n# Option:  actioncheck\n# Notes.:  command executed once before each actionban command\n# Values:  CMD\n#\nactioncheck =\n\n# Option:  actionban\n# Notes.:  command executed when banning an IP. Take care that the\n#          command is executed with Fail2Ban user rights.\n# Tags:    &lt;ip>  IP address\n#          &lt;failures>  number of failures\n#          &lt;time>  unix timestamp of the ban time\n# Values:  CMD\n#\nactionban = /home/all/scripts/fail2ban-sms.sh ban &lt;ip>\n\n# Option:  actionunban\n# Notes.:  command executed when unbanning an IP. Take care that the\n#          command is executed with Fail2Ban user rights.\n# Tags:    &lt;ip>  IP address\n#          &lt;failures>  number of failures\n#          &lt;time>  unix timestamp of the ban time\n# Values:  CMD\n#\nactionunban = /home/all/scripts/fail2ban-sms.sh unban &lt;ip>\n\n[Init]\n\ninit = \'Custom startup message</code></pre>\n<p>Above you see we don&#39;t actually send text messages directly from within this file, but invoke the script located at /home/all/scripts/fail2ban-sms.sh. We use the &lt;ip&gt; variable to be send in the text message and pass it as an argument to the script. </p>\n<p>Using scripts makes it easier to change the texting implementation later on (or when we would like to change provider).</p>\n<p>Before we look into the text messaging script, let&#39;s activate the command.</p>\n<h2>Config fail.local to execute action</h2>\n<p>Configure Fail2ban by copying jail.conf to jail.local and edit the file. We want texting whenever someone tries to bruteforce ssh. So we add &quot;sms&quot; to the list of actions in the ssh section like below.</p>\n<pre><code>#\n# in /etc/fail2ban/jail.local.\n#\n# Optionally you may override any other parameter (e.g. banaction,\n# action, port, logpath, etc) in that section within jail.local\n\n[ssh]\n\nenabled  = true\nport     = ssh\nfilter   = sshd\nlogpath  = /var/log/auth.log\nmaxretry = 6\naction = mail-whois[name=SSH, dest=my.email@gmail.com]\n         sms</code></pre>\n<h2>Texting using twilio</h2>\n<p><a href="https://www.twilio.com/">Twilio&#39;s API</a> makes it easy to send sms&#39;s. Just POST to their api to text. Below you find the script used to perform the request to their API.</p>\n<pre><code>#!/bin/bash\n\n# Sends text messages using twilio api\n# to alert webmaster of banning.\n#\n# Requires one argument, one of the following:\n#  start\n#  stop\n#  ban\n#  unban\n#\n# Optional second argument: IP for ban/unban\n\n\n\n# Include file with the following content:\n#   sid=&lt;twilio account sid>\n#   token=&lt;twilio auth token>\n#   from=&lt;phone number>\n#   to=&lt;phone number>\nsource secret.conf\n\n\n\n# Display usage information\nfunction show_usage {\n  echo "Usage: $0 action &lt;ip>"\n  echo "Where action is start, stop, ban, unban"\n  echo "and ip is optional passed to ban, unban"\n  exit\n}\n\n\n\n# Actually send sms\n# Expects the sms content (body) to be passed\n# as argument.\nfunction send_sms {\n  /usr/bin/curl -X POST "https://api.twilio.com/2010-04-01/Accounts/$sid/SMS/Messages.json" -d "From=$from" -d "To=$to" -d "Body=$1" -u "$sid:$token" >> \'/home/all/log/fail2ban-sms.log\'    \n  exit\n}\n\n\n\n# Check for script arguments\nif [ $# -lt 1 ]\nthen\n  show_usage\nfi\n\n\n\n# Take action depending on argument\nif [ "$1" = \'start\' ]\nthen\n  message=\'Fail2ban+just+started.\'\n  send_sms $message\nelif [ "$1" = \'stop\' ]\nthen\n  message=\'Fail2ban+just+stopped.\'\n  send_sms $message\nelif [ "$1" = \'ban\' ]\nthen\n  message=$([ "$2" != \'\' ] &amp;&amp; echo "Fail2ban+just+banned+$2" || echo \'Fail2ban+just+banned+an+ip.\' )\n  send_sms $message\nelif [ "$1" = \'unban\' ]\nthen\n  message=$([ "$2" != \'\' ] &amp;&amp; echo "Fail2ban+just+unbanned+$2" || echo "Fail2ban+just+unbanned+an+ip." )\n  send_sms $message\nelse\n  show_usage</code></pre>\n<p>The script expects a secret.conf in the same directory to read the Twilio authentication data and phone numbers from. The output of the requests are appended to a logfile in /home/all/log/fail2ban-sms.log.</p>\n<h2>Repo</h2>\n<p>You find the config file and script in <a href="https://github.com/toonketels/fail2ban-sms">github repo</a>.</p>\n<h2>Resources</h2>\n<ul>\n<li><a href="http://www.fail2ban.org">www.fail2ban.org</a></li>\n<li><a href="https://www.twilio.com">www.twilio.com</a></li>\n<li><a href="https://github.com/toonketels/fail2ban-sms">github.com/toonketels/fail2ban-sms</a></li>\n<li><a href="http://blog.redbranch.net/2013/02/28/fail2ban-custom-action">blog.redbranch.net/2013/02/28/fail2ban-custom-action</a></li>\n</ul>\n',teaser:'<p>To prevent scripts from brute forcing their way into my VPS via SSH I use <a href="http://www.fail2ban.org">Fail2ban</a>. It&#39;s a tool that checks the logs for password failures and set IP rules that blocks that user&#39;s IP for a giv...</p>',createDate:"2013-03-23T00:00:00+01:00",updateDate:"2013-03-23T00:00:00+01:00",createDateFormatted:"2013.03.23",updateDateFormatted:"2013.03.23",createDateTimestamp:"1363993200",updateDateTimestamp:"1363993200"},{uuid:"411fa820-60c1-4b87-b006-4795bd4a4033",author:"Toon Ketels",title:"On passport.js, specific use cases",alias:"on-passportjs-specific-use-cases",type:"article",tags:["expressjs","passportjs","nodejs"],content:'<p><a href="/articles/understanding-passportjs-authentication-flow">In the previous post</a>, I talked about the authentication flow and the flow for subsequent requests using passportjs. This post will cover some specific use cases.</p>\n<h2>What user information to store in the session and what not?</h2>\n<p>It&#39;s best to keep the session information small and only attach user information you actually need (note: some user info should be kept - like for instance the user ID, otherwise passport cannot use its Session Strategy).</p>\n<p>However, if you use the <code>deserializeUser</code> method to go and load the user from the db based on the user ID attached to the session, it&#39;s better to store the entire user object in the session. This will prevent a roundtrip to the database on every request just to fetch user information.</p>\n<h2>How to split up passportjs configuration between multiple files?</h2>\n<p><a href="https://github.com/jaredhanson/passport-local/blob/master/examples/express3/app.js">In the example</a>, all password configuration and Local Strategy definition was specified in the main <code>app.js</code> file.</p>\n<p>The passport instance we get back from <code>require(&#39;passport&#39;)</code> is a singleton. So we can just configure express to <em>use the passport middleware</em> in <code>app.js</code> while <em>configuring passport</em> in another file. They all need to <code>require(&#39;passport&#39;)</code>.</p>\n<p>There&#39;s no need to pass the password instance around.</p>\n<h2>What if my form elements are named email and password instead of username and password?</h2>\n<p>Configure which values passport should use from the request body by the options object passed while configuring the Local Strategy.</p>\n<pre><code>passport.use(new LocalStrategy(\n    {\n        usernameField: &#39;email&#39;,\n        passwordField: &#39;password&#39;    \n    },\n    function verify(email, password, done) {\n\n        findByEmail(email, function(err, user) {\n            if (err) return done(err);\n            if (!user) return done(null, false);\n            passwordHash.compare(password, user.password, function(err, res) {\n                if (err) return done(err);\n                if (!res) return done(null, false);\n                done(null, user);\n            });\n        });\n    }\n));</code></pre>\n<h2>What if I don&#39;t like how passport.authenicate redirects the user but want to respond with a JSON response?</h2>\n<p>Don&#39;t use <code>passport.authenticate</code> as middleware but invoke it directly in the request handler. We need to manually call <code>login</code> for this to work.</p>\n<pre><code>app.post(&#39;/login&#39;, function handleLocalAuthentication(req, res, next) {\n\n    passport.authenticate(&#39;local&#39;, function(err, user, info) {\n        if (err) return next(err);\n        if (!user) {\n            return res.json(403, {\n                message: &quot;no user found&quot;\n            });\n        }\n\n        // Manually establish the session...\n        req.login(user, function(err) {\n            if (err) return next(err);\n            return res.json({\n                message: &#39;user authenticated&#39;,\n            });\n        });\n\n    })(req, res, next);\n};</code></pre>\n<h2>How to restrict access to certain pages?</h2>\n<p>Just define your own middleware to be invoked on certain routes to restrict access. </p>\n<pre><code>// Define it\nmodule.exports = function restrict(req, res, next) {\n    if (req.isUnAuthenticated()) return req.json(403, {message: &#39;Access denied, please log in&#39;});\n\n    next();\n}</code></pre>\n<p>Use it when setting up your routes.</p>\n<pre><code>// Use the restrict middleware\napp.get(&#39;/route-with-restricted-access&#39;, restrict, function(res, res, next) {\n    // Handle request...\n});</code></pre>\n<p>If the user object contains role information, we could make additional checks on which role a user has and depending on that restrict access. </p>\n',teaser:'<p><a href="/articles/understanding-passportjs-authentication-flow">In the previous post</a>, I talked about the authentication flow and the flow for subsequent requests using passportjs. This post will cover some specific use cases.</p>\n<h2>What user information to store in the ...</h2>',createDate:"2013-11-05T09:10:26+01:00",updateDate:"2013-11-05T09:10:26+01:00",createDateFormatted:"2013.11.05",updateDateFormatted:"2013.11.05",createDateTimestamp:"1383639026",updateDateTimestamp:"1383639026"},{uuid:"dcf0d8cc-e63f-4c33-8c9e-ba40a57b012c",author:"Toon Ketels",title:"Understanding passport.js authentication flow",alias:"understanding-passportjs-authentication-flow",type:"article",tags:["expressjs","passportjs","nodejs"],content:'<p>Passport.js is a flexible authentication middleware (allowing users to log in) that can be fully customised and works great with connect/express.</p>\n<p>It is flexible in the sense that it allows for different authentication strategies (think via Twitter, via our own user database - installed via separate modules that can be combined) and it allows us to specify any route or output during authentication.</p>\n<p>The <a href="https://github.com/jaredhanson/passport-local">Local Strategy</a> allows us to authenticate users by looking up their data in the app&#39;s database. It has some <a href="https://github.com/jaredhanson/passport-local/blob/master/examples/express3/app.js">great examples how to use it</a>.</p>\n<p>In this post, we walk through the authentication flow, the next post discusses some <a href="/articles/on-passportjs-specific-use-cases">partical use cases using passportjs</a>.</p>\n<h2>Different parts in using passport.js</h2>\n<p>There are three main parts in using passport.js:</p>\n<ul>\n<li>Requiring the module and using its <code>passport.initialize()</code> and <code>passport.session()</code> middleware with express.</li>\n<li>Configuring passport with at least one Strategy and setting up passport&#39;s <code>serializeUser</code> and <code>deserializeUser</code> methods.</li>\n<li>Specifying a route which uses the <code>passport.authenticate</code> middleware to actually authenticate a user.</li>\n</ul>\n<p>The example clearly demonstrates the different items. We wont go over it again.</p>\n<h2>Authentication request flow</h2>\n<p>With the tree parts configured as in the example, the following happens when a user tries the authenticate via the <code>/login</code> route:</p>\n<ol>\n<li>When the user submits the login form, a <code>POST</code> request to <code>/login</code> is made resulting in the execution of the <code>passport.authenticate</code> middleware we&#39;ve set up.</li>\n<li>As the authenticate middleware for that route is configured to handle the <code>local</code> strategy, passport will invoke our implementation of the local strategy.</li>\n<li>Passport takes the <code>req.body.username</code> and <code>req.body.password</code> and passes it to our verification function in the local strategy.</li>\n<li>Now we do our thing: loading the user from the database and checking if the password given matches the one in the database.</li>\n<li>In case of an Error interacting with our database, we need to invoke <code>done(err)</code>. When we cannot find the user or the passwords do not watch, we invoke <code>done(null, false)</code>. If everything went fine and we want the user to login we invoke <code>done(null, user)</code>.</li>\n<li>Calling <code>done</code> will make the flow jump back into <code>passport.authenticate</code>. It&#39;s passed the error, user and additional info object (if defined).</li>\n<li>If the user was passed, the middleware will call <code>req.login</code> (a passport function attached to the request).</li>\n<li>This will call our <code>passport.serializeUser</code> method we&#39;ve defined earlier. This method can access the user object we passed back to the middleware. It&#39;s its job to determine what data from the user object should be stored in the session. The result of the <code>serializeUser</code> method is attached to the session as <code>req.session.passport.user = { // our serialised user object // }</code>.</li>\n<li>The result is also attached to the request as <code>req.user</code>.</li>\n<li>Once done, our requestHandler is invoked. In the example the user is redirected to the homepage.</li>\n</ol>\n<h2>Subsequent authenticated requests flow</h2>\n<p>On subsequent request, the following occurs:</p>\n<ol>\n<li>Express loads the session data and attaches it to the req. As passport stores the serialised user in the session, the serialised user object can be found at <code>req.session.password.user</code>.</li>\n<li>The general passport middleware we setup (<code>passport.initialize</code>) is invoked on the request, it finds the <code>passport.user</code> attached to the session. If is doesn&#39;t (user is not yet authenticated) it creates it like <code>req.passport.user = {}</code>.</li>\n<li>Next, <code>passport.session</code> is invoked. This middleware is a Passport Strategy invoked on every request. If it finds a serialised user object in the session, it will consider this request authenticated. </li>\n<li>The <code>passport.session</code> middleware calls <code>passport.deserializeUser</code> we&#39;ve setup. Attaching the loaded user object to the request as <code>req.user</code>.</li>\n</ol>\n<h2>Summary passport methods and middleware</h2>\n<ul>\n<li><code>passport.initialize</code> middleware is invoked on every request. It ensures the session contains a <code>passport.user</code> object, which may be empty.</li>\n<li><code>passport.session</code> middleware is a Passport Strategy which will load the user object onto req.user if a serialised user object was found in the server.</li>\n<li><code>passport.deserializeUser</code> is invoked on every request by <code>passport.session</code>. It enables us to load additional user information on every request. This user object is attached to the request as <code>req.user</code> making it accessible in our request handling.</li>\n<li>Our Local Strategy is only invoked on the route which uses the <code>passport.authenticate</code> middleware.</li>\n<li>Only during this authentication <code>passport.serializeUser</code> is invoked allowing us the specify what user information should be stored in the session.</li>\n</ul>\n<h2>Overview passport methods attached to the request</h2>\n<p>To finish an overview of passport methods accessible within request handlers:</p>\n<ul>\n<li><code>req.login()</code></li>\n<li><code>req.logout()</code></li>\n<li><code>req.isAuthenticated()</code></li>\n<li><code>req.isUnAuthenticated()</code></li>\n</ul>\n',teaser:"<p>Passport.js is a flexible authentication middleware (allowing users to log in) that can be fully customised and works great with connect/express.</p>\n<p>It is flexible in the sense that it allows for differe...</p>",createDate:"2013-11-01T08:29:55+01:00",updateDate:"2013-11-01T08:29:55+01:00",createDateFormatted:"2013.11.01",updateDateFormatted:"2013.11.01",createDateTimestamp:"1383290995",updateDateTimestamp:"1383290995"},{uuid:"73b07462-8239-4c9d-b843-8594ff8828ef",author:"Toon Ketels",title:"Get directories size in linux",alias:"get-directories-size-in-linux",type:"note",tags:["cli"],content:"<p>To find out the sizes of the different directories in our current location do:</p>\n<pre><code>du -csh *</code></pre>\n<p>Which stands for:\n<em> du: disk usage\n</em> c: grand total, <em>might think of it as &quot;compute total&quot;</em>\n<em> s: summary\n</em> h: human readable</p>\n",teaser:"<p>To find out the sizes of the different directories in our current location do:</p>\n<pre><code>du -csh *</code></pre>\n<p>Which stands for:\n<em> du: disk usage\n</em> c: grand total, <em>might think of it as &quot;compute total&quot;</em>\n<em> s: summary\n</em> </p>",createDate:"2013-03-15T00:00:00+01:00",updateDate:"2013-03-15T00:00:00+01:00",createDateFormatted:"2013.03.15",updateDateFormatted:"2013.03.15",createDateTimestamp:"1363302000",updateDateTimestamp:"1363302000"},{uuid:"ade2ead9-cabc-4be0-8b97-d727b8b23915",author:"Toon Ketels",title:"How to find out which ports are in use",alias:"how-to-find-out-which-ports-are-in-use",type:"note",tags:["cli"],content:"<p>To list all the ports in use on your machine, do:</p>\n<pre><code>netstat -anf inet</code></pre>\n<p>To see which process is using a specific port, do:</p>\n<pre><code>// sudo lsof -i :&lt;portnumber>\nsudo lsof -i :80</code></pre>\n<p>The above will list all processes using port 80. To kill a process, do:</p>\n<pre><code>// kill -9 &lt;processid>\nkill -9 51377</code></pre>\n",teaser:"<p>To list all the ports in use on your machine, do:</p>\n<pre><code>netstat -anf inet</code></pre>\n<p>To see which process is using a specific port, do:</p>\n<pre><code>// sudo lsof -i :&lt;portnumber>\nsudo lsof -i :80</code></pre>\n<p>The above will list all process</p>",createDate:"2012-07-30T00:00:00+02:00",updateDate:"2012-07-30T00:00:00+02:00",createDateFormatted:"2012.07.30",updateDateFormatted:"2012.07.30",createDateTimestamp:"1343599200",updateDateTimestamp:"1343599200"},{uuid:"bc3afe75-d3b7-4d39-8ca1-6fdafba7b533",author:"Toon Ketels",title:"How to remove all files but one from command line?",alias:"how-to-remove-all-files-but-one-from-command-line",type:"note",tags:["cli"],content:"<p>To remove all files but a given one do:</p>\n<pre><code>find . -type f -not -name &quot;application.make&quot; | xargs rm</code></pre>\n<p>To also remove the directories do:</p>\n<pre><code>find . -not -name &quot;application.make&quot; | xargs rm -r</code></pre>\n",teaser:"<p>To remove all files but a given one do:</p>\n<pre><code>find . -type f -not -name &quot;application.make&quot; | xargs rm</code></pre>\n<p>To also remove the directories do:</p>\n<pre><code>find . -not -name &quot;application.make&quot; | xargs rm -</code></pre>",createDate:"2012-09-15T00:00:00+02:00",updateDate:"2012-09-15T00:00:00+02:00",createDateFormatted:"2012.09.15",updateDateFormatted:"2012.09.15",createDateTimestamp:"1347660000",updateDateTimestamp:"1347660000"},{uuid:"de29f755-12df-4b55-9503-7c09d27df46e",author:"Toon Ketels",title:"Install latest version of node to use without sudo",alias:"install-latest-version-of-node-to-use-without-sudo",type:"note",tags:["nodejs"],content:'<p>Explains the steps I followed to install node from source on Ubuntu server.</p>\n<p>This is just kept as a reference, jump to the resources to get the link to a more detailed article.</p>\n<h2>Ensure we can build/curl</h2>\n<pre><code>// Update package manager\nsudo apt-get update\n\n// Install compiler\nsudo apt-get install build-essential\n\n// Get curl\nsudo apt-get install curl</code></pre>\n<h2>Install node and npm</h2>\n<pre><code>// Add ~/local/bin to your path\necho &#39;export PATH=$HOME/local/bin:$PATH&#39; &gt;&gt; ~/.bashrc\nsource ~/.bashrc\n\n// Create two new directories\nmkdir ~/local ~/node-latest-install\n\n// Download and untar nodejs in latest install folder\ncd ~/node-latest-install\ncurl http://nodejs.org/dist/node-latest.tar.gz | tar xz --strip-components=1\n\n// Start installation limited to local user\n./configure --prefix=~/local\nmake install\n\n// Download npm\ncurl https://npmjs.org/install.sh | sh</code></pre>\n<h2>Resouces</h2>\n<ul>\n<li><a href="https://www.digitalocean.com/community/articles/how-to-install-an-upstream-version-of-node-js-on-ubuntu-12-04">Digital Ocean article the workflow is detailed</a></li>\n<li><a href="https://gist.github.com/isaacs/579814">6 different ways to install node without having to use sudo</a></li>\n<li><a href="http://joyent.com/blog/installing-node-and-npm">More detailed article about installing node by joyent</a></li>\n</ul>\n',teaser:"<p>Explains the steps I followed to install node from source on Ubuntu server.</p>\n<p>This is just kept as a reference, jump to the resources to get the link to a more detailed article.</p>\n<h2>Ensure we can build/curl</h2>...",createDate:"2013-03-15T00:00:00+01:00",updateDate:"2013-03-15T00:00:00+01:00",createDateFormatted:"2013.03.15",updateDateFormatted:"2013.03.15",createDateTimestamp:"1363302000",updateDateTimestamp:"1363302000"},{uuid:"e1586e84-f196-499f-8806-1adda0f1f4ae",author:"Toon Ketels",title:"View logfiles while logs update",alias:"view-logfiles-while-logs-update",type:"note",tags:["cli"],content:'<p>To view logfiles while they update do:</p>\n<pre><code>tail -f path/to/logfile_name</code></pre>\n<p>Thanks <a href="http://twitter.com/Yiroon">Jeroen</a> for the tip.</p>\n',teaser:'<p>To view logfiles while they update do:</p>\n<pre><code>tail -f path/to/logfile_name</code></pre>\n<p>Thanks <a href="http://twitter.com/Yiroon">Jeroen</a> for the tip.</p>\n',createDate:"2012-09-05T00:00:00+02:00",updateDate:"2012-09-05T00:00:00+02:00",createDateFormatted:"2012.09.05",updateDateFormatted:"2012.09.05",createDateTimestamp:"1346796000",updateDateTimestamp:"1346796000"},{uuid:"cfd18ecc-5ecc-45c6-87fc-72b0c32796dc",author:"Toon Ketels",title:"Visualize latest commits from all branches in git",alias:"visualize-latest-commits-from-all-branches-in-git",type:"note",tags:["git","cli"],content:'<p>Use <a href="http://gitguys.com/topics/git-show-branch-to-see-branches-and-their-commits">git show-branch</a> to know which branch last was committed to.</p>\n<pre><code>git show-branch --color</code></pre>\n<p>It visualizes all branches with their last commits.</p>\n',teaser:'<p>Use <a href="http://gitguys.com/topics/git-show-branch-to-see-branches-and-their-commits">git show-branch</a> to know which branch last was committed to.</p>\n<pre><code>git show-branch --color</code></pre>\n<p>It visualizes all branches with their last commits.</p>\n',createDate:"2012-07-30T00:00:00+02:00",updateDate:"2012-07-30T00:00:00+02:00",createDateFormatted:"2012.07.30",updateDateFormatted:"2012.07.30",createDateTimestamp:"1343599200",updateDateTimestamp:"1343599200"},{uuid:"ab6659e3-3e28-4fe2-941f-6da5b1f84682",author:"Toon Ketels",title:"Backbone.js, no more JavaScript spaghetti code",alias:"backbonejs-no-more-javascript-spaghetti-code",type:"talk",tags:["backbonejs","drupalJam"],content:'<p>As backbone.js is committed to drupal 8, I gave an introduction talk about backbone at drupalJam in the the Netherlands.</p>\n<p>It&#39;s all about Backbone.js fundamentals with models, collections, views and their interaction (change event - rendering), to really understand what&#39;s going and how it helps manage JavaScript application complexity.</p>\n<p>Checkout the <a href="https://speakerdeck.com/toonketels/introducing-backbone-dot-js">presentation slides</a> and <a href="https://github.com/toonketels/backbone-presentation-demo">demo code</a>.</p>\n',teaser:"<p>As backbone.js is committed to drupal 8, I gave an introduction talk about backbone at drupalJam in the the Netherlands.</p>\n<p>It&#39;s all about Backbone.js fundamentals with models, collections, views and...</p>",createDate:"2013-05-17T00:00:00+02:00",updateDate:"2013-05-17T00:00:00+02:00",createDateFormatted:"2013.05.17",updateDateFormatted:"2013.05.17",createDateTimestamp:"1368741600",updateDateTimestamp:"1368741600"},{uuid:"7f4c6d89-0626-466d-bbfc-5be42c11d987",author:"Toon Ketels",title:"Introducing d3js at fronteers meetup",alias:"d3js-presentation-fronteers-meetup",type:"talk",tags:["d3js","fronteers"],content:'<p>I presented about d3.js at a <a href="http://fronteers.nl/bijeenkomsten/2013/thomas-more">fronteers meetup</a> in Mechelen.</p>\n<p>The talk is a practical d3.js introduction to teach some of d3&#39;s fundamentals such as data-joins, scales, axis, labels, ticks, animations...</p>\n<p>We started off with a plain SVG representing a chart, refine it, in each iteration touching a new topic to actually update the chart (animate bars and scale) every x minutes.</p>\n<p>Take a look at the <a href="https://speakerdeck.com/toonketels/introducing-d3-dot-js">presentation slides</a> and the <a href="https://github.com/toonketels/d3-presentation-demo">demo code</a>.</p>\n<h2>Resources</h2>\n<ul>\n<li><a href="https://speakerdeck.com/toonketels/introducing-d3-dot-js">Presentation slides</a></li>\n<li><a href="https://github.com/toonketels/d3-presentation-demo">Presentation demo code</a></li>\n<li><a href="http://fronteers.nl/bijeenkomsten/2013/thomas-more">Fronteers announcement</a></li>\n</ul>\n',teaser:'<p>I presented about d3.js at a <a href="http://fronteers.nl/bijeenkomsten/2013/thomas-more">fronteers meetup</a> in Mechelen.</p>\n<p>The talk is a practical d3.js introduction to teach some of d3&#39;s fundamentals such as data-joins, scales, axis, labels, ticks, animations...</p>',createDate:"2013-05-23T00:00:00+02:00",updateDate:"2013-05-23T00:00:00+02:00",createDateFormatted:"2013.05.23",updateDateFormatted:"2013.05.23",createDateTimestamp:"1369260000",updateDateTimestamp:"1369260000"},{uuid:"7b56e919-f0c4-4258-809b-1c98c0b8c14b",author:"Toon Ketels",title:"DUG about Backbone.js",alias:"dug-backbonejs",type:"talk",content:'<p>Already introduced Backbone.js to Dutch Drupal developers. Today organized a Drupal User Group to talk about backbone.js to Belgian Drupal devs. Fortunately, we could spend a bit more time on the topic. Really enjoyed the talk. Audience asked lots of interesting questions.</p>\n<p>Thanks to <a href="https://twitter.com/sdecabooter">Sven Decabooter</a> for recording the talk and <a href="http://wunderkraut.be">Wunderkraut</a> for hosting the event.</p>\n<p>Recording (in Dutch) and more info can be found on the <a href="http://drupal.be/evenement/dug-introducing-backbonejs-manage-javascript-application-complexity">drupal.be community website</a>.</p>\n',teaser:"<p>Already introduced Backbone.js to Dutch Drupal developers. Today organized a Drupal User Group to talk about backbone.js to Belgian Drupal devs. Fortunately, we could spend a bit more time on the topi...</p>",createDate:"2013-07-11T00:00:00+02:00",updateDate:"2013-07-11T00:00:00+02:00",createDateFormatted:"2013.07.11",updateDateFormatted:"2013.07.11",createDateTimestamp:"1373493600",updateDateTimestamp:"1373493600"},{uuid:"2b23a2f4-c89f-4e71-bad1-05794d1a3fab",author:"Toon Ketels",title:"Get to know backbone.js, before it becomes just another pain in the #!$",alias:"get-to-know-backbonejs-before-it-becomes-just-another-pain",type:"talk",tags:["backbonejs","drupalCampLeuven"],content:'<p>I&#39;ll be presenting about Backbone.js again to the Drupal community tomorrow morning at DrupalCampLeuven. My talk <a href="http://leuven2013.drupalcamp.be/session/get-know-backbonejs-it-becomes-just-another-pain">&#39;Get to know backbone.js, before it becomes just another &quot;pain in the #!$&quot;&#39;</a> addresses the need in the Drupal community to get up to speed about Backbone.js.</p>\n<p>Drupal 8 will ship with backbone.js and although backbone is just a tiny library that makes it much easier to structure JavaScript code, it does make the code more complex. It simplifies maintainability but at the same time adds a layer of complexity by adding new abstractions and rules about organising JavaScript code. It is easy to work with as long as we have an understanding of these rules and concepts. To prevent it being &quot;a pain in the #!$&quot;, we should get to know Backbone.</p>\n<p>As I&#39;m scheduled first thing Sunday morning, I hope people make it that early...</p>\n',teaser:'<p>I&#39;ll be presenting about Backbone.js again to the Drupal community tomorrow morning at DrupalCampLeuven. My talk <a href="http://leuven2013.drupalcamp.be/session/get-know-backbonejs-it-becomes-just-another-pain">&#39;Get to know backbone.js, before it becomes just another &quot;pain in the #!$&...</a></p>',createDate:"2013-09-14T00:00:00+02:00",updateDate:"2013-09-14T00:00:00+02:00",createDateFormatted:"2013.09.14",updateDateFormatted:"2013.09.14",createDateTimestamp:"1379109600",updateDateTimestamp:"1379109600"},{uuid:"ae599d6e-56c3-4e95-93dd-09a26bd9f200",author:"Toon Ketels",title:"Introducing Grunt.js, the JavaScript Task Runner",alias:"introducing-gruntjs-the-javascript-task-runner",type:"talk",tags:["gruntjs","nodejs user group"],content:'<p>Together with <a href="https://twitter.com/anthonyringoet">Anthony Ringoet</a>, I presented about <a href="http://gruntjs.com">Gruntjs</a> at the <a href="http://lanyrd.com/2013/njug-be/schedule">Node.js User Group</a> in Antwerp.</p>\n<p>We gave a practical introduction to using Grunt.js. Once the basics (installing, using) were adressed, we took on some more advanced, in depth topics such as tasks, &quot;magic&quot; config attributes and project scaffolding.</p>\n<p>Checkout the <a href="https://speakerdeck.com/toonketels/introducing-grunt-dot-js-the-javascript-task-runner">presentation slides</a> and the <a href="https://github.com/toonketels/grunt-presentation-demo">demo code</a>.</p>\n',teaser:'<p>Together with <a href="https://twitter.com/anthonyringoet">Anthony Ringoet</a>, I presented about <a href="http://gruntjs.com">Gruntjs</a> at the <a href="http://lanyrd.com/2013/njug-be/schedule">Node.js User Group</a> in Antwerp.</p>\n<p>We gave a practical introduction to using Grunt.js. Once the basics (installing, using) were adressed, we...</p>',createDate:"2013-05-15T00:00:00+02:00",updateDate:"2013-05-15T00:00:00+02:00",createDateFormatted:"2013.05.15",updateDateFormatted:"2013.05.15",createDateTimestamp:"1368568800",updateDateTimestamp:"1368568800"},{uuid:"93778707-23d9-4711-bf5b-f2a07ab04773",author:"Toon Ketels",title:"Tools used to create data visualization Apps for Antwerp",alias:"apps-for-antwerp-data-visualization",type:"project",tags:["visualization"],content:'<p>We used a couple of tools to create our data visualization for <a href="http://knife-io.github.com/Apps-for-Antwerp/">Apps for Antwerp</a>.</p>\n<h2>d3js</h2>\n<p><a href="http://d3js.org/">D3js</a> played a mayor role. It is a JavaScript data visualization library with just the right amount of functionality to create visualizations. It does not try to do too much by providing configurable charts but rather gives you the building blocks necessary to create them.</p>\n<h2>Jade</h2>\n<p>Although we did not write much html, the couple of lines we wrote were generated using <a href="http://jade-lang.com/">jade</a>. I love the DRY, indentation based syntax of jade.</p>\n<h2>Sass</h2>\n<p>Css is generated with <a href="http://sass-lang.com/">sass</a>. I prefer the sass syntax over scss as it&#39;s more concise.</p>\n<h2>Make</h2>\n<p>Both jade and sass needs to be compiled into html and css. We can do so via the command line. To speed up the process, we created a makefile with different commands in it the compile both at the same time. In the future, we might use <a href="http://gruntjs.com/">grunt</a> instead of <a href="http://en.wikipedia.org/wiki/Make_(software">make</a>) though.</p>\n<h2>Foundation</h2>\n<p><a href="http://foundation.zurb.com/">Foundation</a> is used for layout, typography and navigational elements. It&#39;s a front-end framework using sass.</p>\n<h2>jQuery</h2>\n<p>Although we did not make much use of it, Foundation requires <a href="http://jquery.com/">jQuery</a> for some functionality so we included it. D3js also offers selector and animator functions and they are more appropriate for data visualizations.</p>\n<h2>node-csv</h2>\n<p>Preparing the data is an important step in creating data visualizations. We used <a href="http://www.adaltas.com/projects/node-csv/">node-csv</a> in JavaScript scripts executed from the command line to parse and create csv files. This allowed us to combine several csv files and filter out data.</p>\n<h2>node.js express server</h2>\n<p>The final result is hosted as <a href="http://pages.github.com/">gh-pages</a> on Github. During the development we needed a server to serve the csv file. <a href="http://expressjs.com/">Express node.js server</a> was used for that reason. A simpler solution would be to use <a href="https://github.com/cloudhead/node-static">node static</a> or <a href="http://httpd.apache.org/">apache</a> to serve the files.</p>\n',teaser:'<p>We used a couple of tools to create our data visualization for <a href="http://knife-io.github.com/Apps-for-Antwerp/">Apps for Antwerp</a>.</p>\n<h2>d3js</h2>\n<p><a href="http://d3js.org/">D3js</a> played a mayor role. It is a JavaScript data visualization library with just the right amount of functionalit...</p>',createDate:"2012-12-22T00:00:00+01:00",updateDate:"2012-12-22T00:00:00+01:00",createDateFormatted:"2012.12.22",updateDateFormatted:"2012.12.22",createDateTimestamp:"1356130800",updateDateTimestamp:"1356130800"},{uuid:"c8484ac2-2a0f-4c16-9a3b-ba19149b1bc6",author:"Toon Ketels",title:"Corelio annual report with backbonejs and reponsive d3js charts",alias:"corelio-annual-report-with-backbonejs-and-reponsive-d3js-charts",type:"project",tags:["d3js","backbonejs","charts","gruntjs","requirejs"],content:'<p>I was asked by <a href="http://wolfslittlestore.be/">Johan from Wolf&#39;s Little Store</a> to help creating some d3js charts for <a href="http://corelio.be/bedrijfsinfo/jaarverslagen/jv2012">Corelio&#39;s 2012 Annual Report</a>.</p>\n<p>We ended up creating a backbone.js application to display the slides touching on different topics.</p>\n<h2>Some of the challenges</h2>\n<ul>\n<li>Display the chart axis on page load, but only start displaying the chart&#39;s content (graphs) when within the viewport.</li>\n<li>Don&#39;t start showing the chart&#39;s content when the visitor is scrolling very fast over them.</li>\n<li>Initially, the charts had a fixed width. We ended up making the charts responsive by adapting to the available width.</li>\n<li>The visitor can scroll to specific slides using the menu.</li>\n<li>Create a static one pager with a JavaScript application to make everything interactive.</li>\n<li>Make parts of the d3.js charts reusable since we created several of them.</li>\n</ul>\n<h2>Some of the tools used</h2>\n<ul>\n<li><a href="http://backbonejs.org">Backbone.js</a>: to structure the application and keep us sane</li>\n<li><a href="http://d3js.org">D3.js</a>: to create the different charts</li>\n<li><a href="http://imakewebthings.com/jquery-waypoints">jQuery waypoints</a>: to decide when to display the chart&#39;s contents and figure out which menu link to activate</li>\n<li><a href="http://gruntjs.com">Gruntjs</a>: to help us build the endresult, which is basically one static file</li>\n<li><a href="http://requirejs.org">require.js</a>: to load the different JavaScript files and divide the JavaScript application in different modules</li>\n</ul>\n<p>Checkout the <a href="http://corelio.be/bedrijfsinfo/jaarverslagen/jv2012">endresult</a>.</p>\n',teaser:'<p>I was asked by <a href="http://wolfslittlestore.be/">Johan from Wolf&#39;s Little Store</a> to help creating some d3js charts for <a href="http://corelio.be/bedrijfsinfo/jaarverslagen/jv2012">Corelio&#39;s 2012 Annual Report</a>.</p>\n<p>We ended up creating a backbone.js application to display the slides touching ...</p>',createDate:"2013-05-12T00:00:00+02:00",updateDate:"2013-05-12T00:00:00+02:00",createDateFormatted:"2013.05.12",updateDateFormatted:"2013.05.12",createDateTimestamp:"1368309600",updateDateTimestamp:"1368309600"},{uuid:"f979d1a1-6dd0-4498-adb1-315abed2984c",author:"Toon Ketels",title:"Visualization worldwide Spotify track availability with d3js and Twitter's flight framework",alias:"visualization-spotify-track-availability-d3js-twitter-flight",type:"project",tags:["d3js","flight","Spotify","visualization","requirejs"],content:'<p>To get familiar with Twitter&#39;s flight framework, I created a small <a href="http://toonketels.github.io/spotify-search">data visualization of Spotify&#39;s worldwide track availabilty</a>.</p>\n<p>I use the Spotify API to find the availability of the track wordwide.</p>\n<p>The results are visualized with d3.js. The countries for which the track is available are highlighted on a globe, created with d3js geo capabilities. To rotate the globe, drag it.</p>\n<p>The dataset is a combination of the results returned by the Spotify API, wikipedia country ISO codes list and a json file specifying the country borders.</p>\n<h2>Resources</h2>\n<ul>\n<li><a href="http://toonketels.github.io/spotify-search">Application demo</a></li>\n<li><a href="">Application github repo</a></li>\n<li><a href="http://d3js.org">d3js</a></li>\n<li><a href="http://twitter.github.io/flight">Twitter flight</a></li>\n</ul>\n',teaser:'<p>To get familiar with Twitter&#39;s flight framework, I created a small <a href="http://toonketels.github.io/spotify-search">data visualization of Spotify&#39;s worldwide track availabilty</a>.</p>\n<p>I use the Spotify API to find the availability of the track word...</p>',createDate:"2013-02-19T00:00:00+01:00",updateDate:"2013-02-19T00:00:00+01:00",createDateFormatted:"2013.02.19",updateDateFormatted:"2013.02.19",createDateTimestamp:"1361228400",updateDateTimestamp:"1361228400"}]}),define("commands/BootstrapNodesCommand",["underscore","collections/NodeCollection","json!../../../node/index.html"],function(e,t,n){var r=function(){};return e.extend(r.prototype,{execute:function(){this.context.nodes=new t(n,{context:this.context})}}),r}),define("base/Region",["marionette","backbone.geppetto"],function(e,t){return e.Region.extend({constructor:function(n){n&&n.context&&t.bindContext({view:this,context:n.context}),e.Region.prototype.constructor.apply(this,arguments)}})}),define("base/views/ItemView",["marionette","backbone.geppetto","underscore"],function(e,t,n){var r=e.ItemView.extend({constructor:function(n){n&&n.context&&t.bindContext({view:this,context:n.context}),n&&n.selector&&(this.selector=n.selector),e.ItemView.prototype.constructor.apply(this,arguments)}});return n.extend(r.prototype,{getExistingViewSelector:function(){return this.className&&this.model&&this.model.id?"."+this.className.replace(/\ /g,".")+".model-"+this.model.id:!1},isAlreadyRendered:function(){var e=this.selector||this.getExistingViewSelector(),t;if(e){t=$(e);if(t.length>0)return this.setElement(t),!0}return!1}}),r}),function(){function v(e,t,n){n=a;var r="__p+='"+e.replace(h,function(e){return"\\"+l[e]}).replace(n.escape||f,function(e,t){return"'+_.escape("+d(t)+")+'"}).replace(n.interpolate||f,function(e,t){return"'+("+d(t)+")+'"}).replace(n.evaluate||f,function(e,t){return"';"+d(t)+";__p+='"})+"';";n.variable||(r="with(obj||{}){"+r+"}"),r="var __p='';var print=function(){__p+=Array.prototype.join.call(arguments, '')};"+r+"return __p;";var i=new Function(n.variable||"obj","_",r);if(t)return i(t,_);var s=function(e){return i.call(this,e,_)};return s.source="function("+(n.variable||"obj")+"){"+r+"}",s}var e=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],t=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,n=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,r=typeof location!="undefined"&&location.href,i=r&&location.protocol&&location.protocol.replace(/\:/,""),s=r&&location.hostname,o=r&&(location.port||undefined),u=[],a={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g},f=/.^/,l={"\\":"\\","'":"'",r:"\r",n:"\n",t:"	",u2028:"\u2028",u2029:"\u2029"};for(var c in l)l[l[c]]=c;var h=/\\|'|\r|\n|\t|\u2028|\u2029/g,p=/\\(\\|'|r|n|t|u2028|u2029)/g,d=function(e){return e.replace(p,function(e,t){return l[t]})};define("tpl",[],function(){var a,f,l;return typeof window!="undefined"&&window.navigator&&window.document?f=function(e,t){var n=a.createXhr();n.open("GET",e,!0),n.onreadystatechange=function(e){n.readyState===4&&t(n.responseText)},n.send(null)}:typeof process!="undefined"&&process.versions&&!!process.versions.node?(l=require.nodeRequire("fs"),f=function(e,t){t(l.readFileSync(e,"utf8"))}):typeof Packages!="undefined"&&(f=function(e,t){var n="utf-8",r=new java.io.File(e),i=java.lang.System.getProperty("line.separator"),s=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(r),n)),o,u,a="";try{o=new java.lang.StringBuffer,u=s.readLine(),u&&u.length()&&u.charAt(0)===65279&&(u=u.substring(1)),o.append(u);while((u=s.readLine())!==null)o.append(i),o.append(u);a=String(o.toString())}finally{s.close()}t(a)}),a={version:"1.0.0",strip:function(e){if(e){e=e.replace(t,"");var r=e.match(n);r&&(e=r[1])}else e="";return e},jsEscape:function(e){return e.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r")},createXhr:function(){var t,n,r;if(typeof XMLHttpRequest!="undefined")return new XMLHttpRequest;for(n=0;n<3;n++){r=e[n];try{t=new ActiveXObject(r)}catch(i){}if(t){e=[r];break}}if(!t)throw new Error("createXhr(): XMLHttpRequest not available");return t},get:f,parseName:function(e){var t=!1,n=e.indexOf("."),r=e.substring(0,n),i=e.substring(n+1,e.length);return n=i.indexOf("!"),n!==-1&&(t=i.substring(n+1,i.length),t=t==="strip",i=i.substring(0,n)),{moduleName:r,ext:i,strip:t}},xdRegExp:/^((\w+)\:)?\/\/([^\/\\]+)/,useXhr:function(e,t,n,r){var i=a.xdRegExp.exec(e),s,o,u;return i?(s=i[2],o=i[3],o=o.split(":"),u=o[1],o=o[0],(!s||s===t)&&(!o||o===n)&&(!u&&!o||u===r)):!0},finishLoad:function(e,t,n,r,i){n=t?a.strip(n):n;var s=v(n),o=s.source;i.isBuild&&i.inlineText&&(u[e]=o),r(s)},load:function(e,t,n,u){var f=a.parseName(e),l=f.moduleName+"."+f.ext,c=t.toUrl(l),h=u&&u.text&&u.text.useXhr||a.useXhr;!r||h(c,i,s,o)?a.get(c,function(t){a.finishLoad(e,f.strip,t,n,u)}):t([l],function(e){a.finishLoad(f.moduleName+"."+f.ext,f.strip,e,n,u)})},write:function(e,t,n,r){if(t in u){var i=u[t];n('define("'+e+"!"+t+'", function() { return '+i+"; });\n")}},writeFile:function(e,t,n,r,i){var s=a.parseName(t),o=s.moduleName+"."+s.ext,u=n.toUrl(s.moduleName+"."+s.ext)+".js";a.load(o,n,function(t){var n=function(e){return r(u,e)};n.asModule=function(e,t){return r.asModule(e,u,t)},a.write(e,o,n,i)},i)}},a})}(),define("tpl!templates/HeaderDetailView.tpl.html",function(){return function(obj){var __p="",print=function(){__p+=Array.prototype.join.call(arguments,"")};with(obj||{})__p+='<div class="susy-cols split-from-break-large split-ratio-1-5">\n  <div class="col">\n    <a href="/"><img src="/images/logo.png" alt="Toon.io"></a>\n  </div>\n  <div class="col-last">\n    <ul class="meta">\n      <li>'+createDateFormatted+"</li>\n      <li>"+getTags()+"</li>\n      <li>"+author+"</li>\n    </ul>\n    <h2>"+title+"</h2>\n  </div>\n</div>";return __p}}),define("views/HeaderDetailView",["base/views/ItemView","tpl!templates/HeaderDetailView.tpl.html","underscore"],function(e,t,n){return e.extend({template:t,className:"header-detail-view inner-content",events:{"click a":"goHome"},templateHelpers:{getTags:function(){return this.tags?this.type+", "+this.tags.join(", "):this.type}},goHome:function(e){e.preventDefault(),this.context.router.navigate("",{trigger:!0})}})}),define("tpl!templates/HeaderListView.tpl.html",function(){return function(obj){var __p="",print=function(){__p+=Array.prototype.join.call(arguments,"")};with(obj||{})__p+='<div class="susy-cols split-from-break-large split-ratio-1-5">\n  <div class="col">\n    <img src="/images/logo.png" alt="Toon.io">\n  </div>\n  <div class="col-last">\n    <h1>Hi. I’m Toon.<br>I’m a freelance JavaScript developer.<h1>\n    <h2>I specialize in writing great JavaScript using tools like d3, backbone and marionette.</h2>\n  </div>\n</div>';return __p}}),define("base/Layout",["marionette","backbone.geppetto"],function(e,t){var n=e.Layout.extend({constructor:function(n){n&&n.context&&t.bindContext({view:this,context:n.context}),e.Layout.prototype.constructor.apply(this,arguments)}});return _.extend(n.prototype,{getExistingViewSelector:function(){return this.className?"."+this.className.replace(/\ /g,"."):!1},isAlreadyRendered:function(){var e=this.selector||this.getExistingViewSelector(),t;if(e){t=$(e);if(t.length>0)return this.setElement(t),!0}return!1}}),n}),define("tpl!templates/Transitioner.tpl.html",function(){return function(obj){var __p="",print=function(){__p+=Array.prototype.join.call(arguments,"")};with(obj||{})__p+='<ul class="sequence-canvas">\n    <li class="first animate-in">\n        <div class="slide slide1">\n        </div>\n    </li>\n    <li>\n        <div class="slide slide2">\n        </div>\n    </li>\n</ul>';return __p}}),function(e){function n(n,r,i,s){function f(){o.afterLoaded(),o.settings.hideFramesUntilPreloaded&&o.settings.preloader!==undefined&&o.settings.preloader!==!1&&o.frames.show(),o.settings.preloader!==undefined&&o.settings.preloader!==!1?o.settings.hidePreloaderUsingCSS&&o.transitionsSupported?(o.prependPreloadingCompleteTo=o.settings.prependPreloadingComplete===!0?o.settings.preloader:e(o.settings.prependPreloadingComplete),o.prependPreloadingCompleteTo.addClass("preloading-complete"),setTimeout(g,o.settings.hidePreloaderDelay)):o.settings.preloader.fadeOut(o.settings.hidePreloaderDelay,function(){clearInterval(o.defaultPreloader),g()}):g()}function h(t,n){var r=[];if(!n)for(var i=t;i>0;i--)o.frames.eq(o.settings.preloadTheseFrames[i-1]-1).find("img").each(function(){r.push(e(this)[0])});else for(var s=t;s>0;s--)r.push(e("body").find('img[src="'+o.settings.preloadTheseImages[s-1]+'"]'));return r}function p(t,n){function c(){var t=e(f),r=e(l);s&&(l.length?s.reject(u,t,r):s.resolve(u)),e.isFunction(n)&&n.call(i,u,t,r)}function h(t,n){if(t.src===r||e.inArray(t,a)!==-1)return;a.push(t),n?l.push(t):f.push(t),e.data(t,"imagesLoaded",{isBroken:n,src:t.src}),o&&s.notifyWith(e(t),[n,u,e(f),e(l)]),u.length===a.length&&(setTimeout(c),u.unbind(".imagesLoaded"))}var r="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==",i=t,s=e.isFunction(e.Deferred)?e.Deferred():0,o=e.isFunction(s.notify),u=i.find("img").add(i.filter("img")),a=[],f=[],l=[];e.isPlainObject(n)&&e.each(n,function(e,t){e==="callback"?n=t:s&&s[e](t)}),u.length?u.bind("load.imagesLoaded error.imagesLoaded",function(e){h(e.target,e.type==="error")}).each(function(t,n){var i=n.src,s=e.data(n,"imagesLoaded");if(s&&s.src===i){h(n,s.isBroken);return}if(n.complete&&n.naturalWidth!==undefined){h(n,n.naturalWidth===0||n.naturalHeight===0);return}if(n.readyState||n.complete)n.src=r,n.src=i}):c()}function g(){function t(e,t){var r,i;for(i in t)i==="left"||i==="right"?r=n[i]:r=i,e===parseFloat(r)&&o._initCustomKeyEvent(t[i])}function r(){o.canvas.on("touchmove.sequence",i),u=null,f=!1}function i(e){o.settings.swipePreventsDefault&&e.preventDefault();if(f){var t=e.originalEvent.touches[0].pageX,n=e.originalEvent.touches[0].pageY,i=u-t,s=a-n;Math.abs(i)>=o.settings.swipeThreshold?(r(),i>0?o._initCustomKeyEvent(o.settings.swipeEvents.left):o._initCustomKeyEvent(o.settings.swipeEvents.right)):Math.abs(s)>=o.settings.swipeThreshold&&(r(),s>0?o._initCustomKeyEvent(o.settings.swipeEvents.down):o._initCustomKeyEvent(o.settings.swipeEvents.up))}}function s(e){e.originalEvent.touches.length===1&&(u=e.originalEvent.touches[0].pageX,a=e.originalEvent.touches[0].pageY,f=!0,o.canvas.on("touchmove.sequence",i))}e(o.settings.preloader).remove(),o.nextButton=o._renderUiElements(o.settings.nextButton,".sequence-next"),o.prevButton=o._renderUiElements(o.settings.prevButton,".sequence-prev"),o.pauseButton=o._renderUiElements(o.settings.pauseButton,".sequence-pause"),o.pagination=o._renderUiElements(o.settings.pagination,".sequence-pagination"),o.nextButton!==undefined&&o.nextButton!==!1&&o.settings.showNextButtonOnInit===!0&&o.nextButton.show(),o.prevButton!==undefined&&o.prevButton!==!1&&o.settings.showPrevButtonOnInit===!0&&o.prevButton.show(),o.pauseButton!==undefined&&o.pauseButton!==!1&&o.settings.showPauseButtonOnInit===!0&&o.pauseButton.show(),o.settings.pauseIcon!==!1?(o.pauseIcon=o._renderUiElements(o.settings.pauseIcon,".sequence-pause-icon"),o.pauseIcon!==undefined&&o.pauseIcon.hide()):o.pauseIcon=undefined,o.pagination!==undefined&&o.pagination!==!1&&(o.paginationLinks=o.pagination.children(),o.paginationLinks.on("click.sequence",function(){var t=e(this).index()+1;o.goTo(t)}),o.settings.showPaginationOnInit===!0&&o.pagination.show()),o.nextFrameID=o.settings.startingFrameID,o.settings.hashTags===!0&&(o.frames.each(function(){o.frameHashID.push(e(this).prop(o.getHashTagFrom))}),o.currentHashTag=location.hash.replace("#",""),o.currentHashTag===undefined||o.currentHashTag===""?o.nextFrameID=o.settings.startingFrameID:(o.frameHashIndex=e.inArray(o.currentHashTag,o.frameHashID),o.frameHashIndex!==-1?o.nextFrameID=o.frameHashIndex+1:o.nextFrameID=o.settings.startingFrameID)),o.nextFrame=o.frames.eq(o.nextFrameID-1),o.nextFrameChildren=o.nextFrame.children(),o.pagination!==undefined&&e(o.paginationLinks[o.settings.startingFrameID-1]).addClass("current"),o.transitionsSupported?o.settings.animateStartingFrameIn?o.settings.reverseAnimationsWhenNavigatingBackwards&&o.settings.autoPlayDirection-1&&o.settings.animateStartingFrameIn?(o._resetElements(o.transitionPrefix,o.nextFrameChildren,"0s"),o.nextFrame.addClass("animate-out"),o.goTo(o.nextFrameID,-1,!0)):o.goTo(o.nextFrameID,1,!0):(o.currentFrameID=o.nextFrameID,o.settings.moveActiveFrameToTop&&o.nextFrame.css("z-index",o.numberOfFrames),o._resetElements(o.transitionPrefix,o.nextFrameChildren,"0s"),o.nextFrame.addClass("animate-in"),o.settings.hashTags&&o.settings.hashChangesOnFirstFrame&&(o.currentHashTag=o.nextFrame.prop(o.getHashTagFrom),document.location.hash="#"+o.currentHashTag),setTimeout(function(){o._resetElements(o.transitionPrefix,o.nextFrameChildren,"")},100),o._resetAutoPlay(!0,o.settings.autoPlayDelay)):(o.container.addClass("sequence-fallback"),o.currentFrameID=o.nextFrameID,o.settings.hashTags&&o.settings.hashChangesOnFirstFrame&&(o.currentHashTag=o.nextFrame.prop(o.getHashTagFrom),document.location.hash="#"+o.currentHashTag),o.frames.addClass("animate-in"),o.frames.not(":eq("+(o.nextFrameID-1)+")").css({display:"none",opacity:0}),o._resetAutoPlay(!0,o.settings.autoPlayDelay)),o.nextButton!==undefined&&o.nextButton.bind("click.sequence",function(){o.next()}),o.prevButton!==undefined&&o.prevButton.bind("click.sequence",function(){o.prev()}),o.pauseButton!==undefined&&o.pauseButton.bind("click.sequence",function(){o.pause(!0)});if(o.settings.keyNavigation){var n={left:37,right:39};e(document).bind("keydown.sequence",function(e){var n=String.fromCharCode(e.keyCode);n>0&&n<=o.numberOfFrames&&o.settings.numericKeysGoToFrames&&(o.nextFrameID=n,o.goTo(o.nextFrameID)),t(e.keyCode,o.settings.keyEvents),t(e.keyCode,o.settings.customKeyEvents)})}o.canvas.on({"mouseenter.sequence":function(){o.settings.pauseOnHover&&o.settings.autoPlay&&!o.hasTouch&&(o.isBeingHoveredOver=!0,o.isHardPaused||o.pause())},"mouseleave.sequence":function(){o.settings.pauseOnHover&&o.settings.autoPlay&&!o.hasTouch&&(o.isBeingHoveredOver=!1,o.isHardPaused||o.unpause())}}),o.settings.hashTags&&e(window).bind("hashchange.sequence",function(){var t=location.hash.replace("#","");o.currentHashTag!==t&&(o.currentHashTag=t,o.frameHashIndex=e.inArray(o.currentHashTag,o.frameHashID),o.frameHashIndex!==-1&&(o.nextFrameID=o.frameHashIndex+1,o.goTo(o.nextFrameID)))});if(o.settings.swipeNavigation&&o.hasTouch){var u,a,f=!1;o.canvas.on("touchstart.sequence",s)}}var o=this;o.container=e(n),o.canvas=o.container.children(".sequence-canvas"),o.frames=o.canvas.children("li"),o._modernizrForSequence();var u={WebkitTransition:"-webkit-",WebkitAnimation:"-webkit-",MozTransition:"-moz-","MozAnimation ":"-moz-",OTransition:"-o-",OAnimation:"-o-",msTransition:"-ms-",msAnimation:"-ms-",transition:"",animation:""},a={WebkitTransition:"webkitTransitionEnd.sequence",WebkitAnimation:"webkitAnimationEnd.sequence",MozTransition:"transitionend.sequence",MozAnimation:"animationend.sequence",OTransition:"otransitionend.sequence",OAnimation:"oanimationend.sequence",msTransition:"MSTransitionEnd.sequence",msAnimation:"MSAnimationEnd.sequence",transition:"transitionend.sequence",animation:"animationend.sequence"};o.transitionPrefix=u[ModernizrForSequence.prefixed("transition")],o.animationPrefix=u[ModernizrForSequence.prefixed("animation")],o.transitionProperties={},o.transitionEnd=a[ModernizrForSequence.prefixed("transition")]+" "+a[ModernizrForSequence.prefixed("animation")],o.numberOfFrames=o.frames.length,o.transitionsSupported=o.transitionPrefix!==undefined?!0:!1,o.hasTouch="ontouchstart"in window?!0:!1,o.isPaused=!1,o.isBeingHoveredOver=!1,o.container.removeClass("sequence-destroyed"),o.paused=function(){},o.unpaused=function(){},o.beforeNextFrameAnimatesIn=function(){},o.afterNextFrameAnimatesIn=function(){},o.beforeCurrentFrameAnimatesOut=function(){},o.afterCurrentFrameAnimatesOut=function(){},o.afterLoaded=function(){},o.destroyed=function(){},o.settings=e.extend({},i,r),o.settings.preloader=o._renderUiElements(o.settings.preloader,".sequence-preloader"),o.isStartingFrame=o.settings.animateStartingFrameIn?!0:!1,o.settings.unpauseDelay=o.settings.unpauseDelay===null?o.settings.autoPlayDelay:o.settings.unpauseDelay,o.getHashTagFrom=o.settings.hashDataAttribute?"data-sequence-hashtag":"id",o.frameHashID=[],o.direction=o.settings.autoPlayDirection,o.settings.hideFramesUntilPreloaded&&o.settings.preloader!==undefined&&o.settings.preloader!==!1&&o.frames.hide(),o.transitionPrefix==="-o-"&&(o.transitionsSupported=o._operaTest()),o.frames.removeClass("animate-in");var l=o.settings.preloadTheseFrames.length,c=o.settings.preloadTheseImages.length;if(o.settings.preloader===undefined||o.settings.preloader===!1||l===0&&c===0)t===!0?(f(),e(this).unbind("load.sequence")):e(window).bind("load.sequence",function(){f(),e(this).unbind("load.sequence")});else{var d=h(l),v=h(c,!0),m=e(d.concat(v));p(m,f)}}var t=!1;e(window).bind("load",function(){t=!0}),n.prototype={startAutoPlay:function(e){var t=this;e=e===undefined?t.settings.autoPlayDelay:e,t.unpause(),t._resetAutoPlay(),t.autoPlayTimer=setTimeout(function(){t.settings.autoPlayDirection===1?t.next():t.prev()},e)},stopAutoPlay:function(){var e=this;e.pause(!0),clearTimeout(e.autoPlayTimer)},pause:function(e){var t=this;t.isSoftPaused?t.unpause():(t.pauseButton!==undefined&&(t.pauseButton.addClass("paused"),t.pauseIcon!==undefined&&t.pauseIcon.show()),t.paused(),t.isSoftPaused=!0,t.isHardPaused=e?!0:!1,t.isPaused=!0,t._resetAutoPlay())},unpause:function(e){var t=this;t.pauseButton!==undefined&&(t.pauseButton.removeClass("paused"),t.pauseIcon!==undefined&&t.pauseIcon.hide()),t.isSoftPaused=!1,t.isHardPaused=!1,t.isPaused=!1,t.active?t.delayUnpause=!0:(e!==!1&&t.unpaused(),t._resetAutoPlay(!0,t.settings.unpauseDelay))},next:function(){var e=this;id=e.currentFrameID!==e.numberOfFrames?e.currentFrameID+1:1,e.active===!1||e.active===undefined?e.goTo(id,1):e.goTo(id,1,!0)},prev:function(){var e=this;id=e.currentFrameID===1?e.numberOfFrames:e.currentFrameID-1,e.active===!1||e.active===undefined?e.goTo(id,-1):e.goTo(id,-1,!0)},goTo:function(t,n,r){var i=this;i.nextFrameID=parseFloat(t);var s=r===!0?0:i.settings.transitionThreshold;if(i.nextFrameID===i.currentFrameID||i.settings.navigationSkip&&i.navigationSkipThresholdActive||!i.settings.navigationSkip&&i.active||!i.transitionsSupported&&i.active||!i.settings.cycle&&n===1&&i.currentFrameID===i.numberOfFrames||!i.settings.cycle&&n===-1&&i.currentFrameID===1||i.settings.preventReverseSkipping&&i.direction!==n&&i.active)return!1;i.settings.navigationSkip&&i.active&&(i.navigationSkipThresholdActive=!0,i.settings.fadeFrameWhenSkipped&&i.nextFrame.stop().animate({opacity:0},i.settings.fadeFrameTime),clearTimeout(i.transitionThresholdTimer),setTimeout(function(){i.navigationSkipThresholdActive=!1},i.settings.navigationSkipThreshold));if(!i.active||i.settings.navigationSkip){i.active=!0,i._resetAutoPlay(),n===undefined?i.direction=i.nextFrameID>i.currentFrameID?1:-1:i.direction=n,i.currentFrame=i.canvas.children(".animate-in"),i.nextFrame=i.frames.eq(i.nextFrameID-1),i.currentFrameChildren=i.currentFrame.children(),i.nextFrameChildren=i.nextFrame.children(),i.pagination!==undefined&&(i.paginationLinks.removeClass("current"),e(i.paginationLinks[i.nextFrameID-1]).addClass("current"));if(i.transitionsSupported)i.currentFrame.length!==undefined?(i.beforeCurrentFrameAnimatesOut(),i.settings.moveActiveFrameToTop&&i.currentFrame.css("z-index",1),i._resetElements(i.transitionPrefix,i.nextFrameChildren,"0s"),!i.settings.reverseAnimationsWhenNavigatingBackwards||i.direction===1?(i.nextFrame.removeClass("animate-out"),i._resetElements(i.transitionPrefix,i.currentFrameChildren,"")):i.settings.reverseAnimationsWhenNavigatingBackwards&&i.direction===-1&&(i.nextFrame.addClass("animate-out"),i._reverseTransitionProperties())):i.isStartingFrame=!1,i.active=!0,i.currentFrame.unbind(i.transitionEnd),i.nextFrame.unbind(i.transitionEnd),i.settings.fadeFrameWhenSkipped&&i.settings.navigationSkip&&i.nextFrame.css("opacity",1),i.beforeNextFrameAnimatesIn(),i.settings.moveActiveFrameToTop&&i.nextFrame.css("z-index",i.numberOfFrames),!i.settings.reverseAnimationsWhenNavigatingBackwards||i.direction===1?(setTimeout(function(){i._resetElements(i.transitionPrefix,i.nextFrameChildren,""),i._waitForAnimationsToComplete(i.nextFrame,i.nextFrameChildren,"in"),(i.afterCurrentFrameAnimatesOut!=="function () {}"||i.settings.transitionThreshold===!0&&r!==!0)&&i._waitForAnimationsToComplete(i.currentFrame,i.currentFrameChildren,"out",!0,1)},50),setTimeout(function(){i.settings.transitionThreshold===!1||i.settings.transitionThreshold===0||r===!0?(i.currentFrame.toggleClass("animate-out animate-in"),i.nextFrame.addClass("animate-in")):(i.currentFrame.toggleClass("animate-out animate-in"),i.settings.transitionThreshold!==!0&&(i.transitionThresholdTimer=setTimeout(function(){i.nextFrame.addClass("animate-in")},s)))},50)):i.settings.reverseAnimationsWhenNavigatingBackwards&&i.direction===-1&&(setTimeout(function(){i._resetElements(i.transitionPrefix,i.currentFrameChildren,""),i._resetElements(i.transitionPrefix,i.nextFrameChildren,""),i._reverseTransitionProperties(),i._waitForAnimationsToComplete(i.nextFrame,i.nextFrameChildren,"in"),(i.afterCurrentFrameAnimatesOut!=="function () {}"||i.settings.transitionThreshold===!0&&r!==!0)&&i._waitForAnimationsToComplete(i.currentFrame,i.currentFrameChildren,"out",!0,-1)},50),setTimeout(function(){i.settings.transitionThreshold===!1||i.settings.transitionThreshold===0||r===!0?(i.currentFrame.removeClass("animate-in"),i.nextFrame.toggleClass("animate-out animate-in")):(i.currentFrame.removeClass("animate-in"),i.settings.transitionThreshold!==!0&&(i.transitionThresholdTimer=setTimeout(function(){i.nextFrame.toggleClass("animate-out animate-in")},s)))},50));else{function o(){i._setHashTag(),i.active=!1,i._resetAutoPlay(!0,i.settings.autoPlayDelay)}switch(i.settings.fallback.theme){case"fade":i.frames.css({position:"relative"}),i.beforeCurrentFrameAnimatesOut(),i.currentFrame=i.frames.eq(i.currentFrameID-1),i.currentFrame.animate({opacity:0},i.settings.fallback.speed,function(){i.currentFrame.css({display:"none","z-index":"1"}),i.afterCurrentFrameAnimatesOut(),i.beforeNextFrameAnimatesIn(),i.nextFrame.css({display:"block","z-index":i.numberOfFrames}).animate({opacity:1},500,function(){i.afterNextFrameAnimatesIn()}),o()}),i.frames.css({position:"relative"});break;case"slide":default:var u={},a={},f={};i.direction===1?(u.left="-100%",a.left="100%"):(u.left="100%",a.left="-100%"),f.left="0",f.opacity=1,i.currentFrame=i.frames.eq(i.currentFrameID-1),i.beforeCurrentFrameAnimatesOut(),i.currentFrame.animate(u,i.settings.fallback.speed,function(){i.currentFrame.css({display:"none","z-index":"1"}),i.afterCurrentFrameAnimatesOut()}),i.beforeNextFrameAnimatesIn(),i.nextFrame.show().css(a),i.nextFrame.css({display:"block","z-index":i.numberOfFrames}).animate(f,i.settings.fallback.speed,function(){o(),i.afterNextFrameAnimatesIn()})}}i.currentFrameID=i.nextFrameID}},destroy:function(t){var n=this;n.container.addClass("sequence-destroyed"),n.nextButton!==undefined&&n.nextButton.unbind("click.sequence"),n.prevButton!==undefined&&n.prevButton.unbind("click.sequence"),n.pauseButton!==undefined&&n.pauseButton.unbind("click.sequence"),n.pagination!==undefined&&n.paginationLinks.unbind("click.sequence"),e(document).unbind("keydown.sequence"),n.canvas.unbind("mouseenter.sequence, mouseleave.sequence, touchstart.sequence, touchmove.sequence"),e(window).unbind("hashchange.sequence"),n.stopAutoPlay(),clearTimeout(n.transitionThresholdTimer),n.canvas.children("li").remove(),n.canvas.prepend(n.frames),n.frames.removeClass("animate-in animate-out").removeAttr("style"),n.frames.eq(n.currentFrameID-1).addClass("animate-in"),n.nextButton!==undefined&&n.nextButton!==!1&&n.nextButton.hide(),n.prevButton!==undefined&&n.prevButton!==!1&&n.prevButton.hide(),n.pauseButton!==undefined&&n.pauseButton!==!1&&n.pauseButton.hide(),n.pauseIcon!==undefined&&n.pauseIcon!==!1&&n.pauseIcon.hide(),n.pagination!==undefined&&n.pagination!==!1&&n.pagination.hide(),t!==undefined&&t(),n.destroyed(),n.container.removeData()},_initCustomKeyEvent:function(e){var t=this;switch(e){case"next":t.next();break;case"prev":t.prev();break;case"pause":t.pause(!0)}},_resetElements:function(e,t,n){var r=this;t.css(r._prefixCSS(e,{"transition-duration":n,"transition-delay":n,"transition-timing-function":""}))},_reverseTransitionProperties:function(){var t=this,n=[],r=[];t.currentFrameChildren.each(function(){n.push(parseFloat(e(this).css(t.transitionPrefix+"transition-duration").replace("s",""))+parseFloat(e(this).css(t.transitionPrefix+"transition-delay").replace("s","")))}),t.nextFrameChildren.each(function(){r.push(parseFloat(e(this).css(t.transitionPrefix+"transition-duration").replace("s",""))+parseFloat(e(this).css(t.transitionPrefix+"transition-delay").replace("s","")))});var i=Math.max.apply(Math,n),s=Math.max.apply(Math,r),o=i-s,u=0,a=0;o<0&&!t.settings.preventDelayWhenReversingAnimations?u=Math.abs(o):o>0&&(a=Math.abs(o));var f=function(n,r,i,s){function o(e){e=e.split(",")[0];var t={linear:"cubic-bezier(0.0,0.0,1.0,1.0)",ease:"cubic-bezier(0.25, 0.1, 0.25, 1.0)","ease-in":"cubic-bezier(0.42, 0.0, 1.0, 1.0)","ease-in-out":"cubic-bezier(0.42, 0.0, 0.58, 1.0)","ease-out":"cubic-bezier(0.0, 0.0, 0.58, 1.0)"};return e.indexOf("cubic-bezier")<0&&(e=t[e]),e}r.each(function(){var r=parseFloat(e(this).css(t.transitionPrefix+"transition-duration").replace("s","")),u=parseFloat(e(this).css(t.transitionPrefix+"transition-delay").replace("s","")),a=e(this).css(t.transitionPrefix+"transition-timing-function");if(a.indexOf("cubic")===-1)var a=o(a);var f=a.replace("cubic-bezier(","").replace(")","").split(",");e.each(f,function(e,t){f[e]=parseFloat(t)});var l=[1-f[2],1-f[3],1-f[0],1-f[1]];a="cubic-bezier("+l+")";var c=r+u;n["transition-duration"]=r+"s",n["transition-delay"]=i-c+s+"s",n["transition-timing-function"]=a,e(this).css(t._prefixCSS(t.transitionPrefix,n))})};f(t.transitionProperties,t.currentFrameChildren,i,u),f(t.transitionProperties,t.nextFrameChildren,s,a)},_prefixCSS:function(e,t){var n=this,r={};for(var i in t)r[e+i]=t[i];return r},_resetAutoPlay:function(e,t){var n=this;e===!0?n.settings.autoPlay&&!n.isSoftPaused&&(clearTimeout(n.autoPlayTimer),n.autoPlayTimer=setTimeout(function(){n.settings.autoPlayDirection===1?n.next():n.prev()},t)):clearTimeout(n.autoPlayTimer)},_renderUiElements:function(t,n){var r=this;switch(t){case!1:return undefined;case!0:return n===".sequence-preloader"&&r._defaultPreloader(r.container,r.transitionsSupported,r.animationPrefix),e(n);default:return e(t)}},_waitForAnimationsToComplete:function(t,n,r,i,s){var o=this;if(r==="out")var u=function(){o.afterCurrentFrameAnimatesOut(),o.settings.transitionThreshold===!0&&(s===1?o.nextFrame.addClass("animate-in"):s===-1&&o.nextFrame.toggleClass("animate-out animate-in"))};else if(r==="in")var u=function(){o.afterNextFrameAnimatesIn(),o._setHashTag(),o.active=!1,!o.isHardPaused&&!o.isBeingHoveredOver&&(o.delayUnpause?(o.delayUnpause=!1,o.unpause()):o.unpause(!1))};n.data("animationEnded",!1),t.bind(o.transitionEnd,function(r){e(r.target).data("animationEnded",!0);var i=!0;n.each(function(){if(e(this).data("animationEnded")===!1)return i=!1,!1}),i&&(t.unbind(o.transitionEnd),u())})},_setHashTag:function(){var t=this;t.settings.hashTags&&(t.currentHashTag=t.nextFrame.prop(t.getHashTagFrom),t.frameHashIndex=e.inArray(t.currentHashTag,t.frameHashID),t.frameHashIndex!==-1&&(t.settings.hashChangesOnFirstFrame||!t.isStartingFrame||!t.transitionsSupported)?(t.nextFrameID=t.frameHashIndex+1,document.location.hash="#"+t.currentHashTag):(t.nextFrameID=t.settings.startingFrameID,t.isStartingFrame=!1))},_modernizrForSequence:function(){window.ModernizrForSequence=function(e,t,n){function r(e){v.cssText=e}function i(e,t){return r(prefixes.join(e+";")+(t||""))}function s(e,t){return typeof e===t}function o(e,t){return!!~(""+e).indexOf(t)}function u(e,t){for(var r in e){var i=e[r];if(!o(i,"-")&&v[i]!==n)return t=="pfx"?i:!0}return!1}function a(e,t,r){for(var i in e){var o=t[e[i]];if(o!==n)return r===!1?e[i]:s(o,"function")?o.bind(r||t):o}return!1}function f(e,t,n){var r=e.charAt(0).toUpperCase()+e.slice(1),i=(e+" "+b.join(r+" ")+r).split(" ");return s(t,"string")||s(t,"undefined")?u(i,t):(i=(e+" "+w.join(r+" ")+r).split(" "),a(i,t,n))}var l="2.6.1",c={},h=t.documentElement,p="modernizrForSequence",d=t.createElement(p),v=d.style,m,g={}.toString,y="Webkit Moz O ms",b=y.split(" "),w=y.toLowerCase().split(" "),E={svg:"http://www.w3.org/2000/svg"},S={},x={},T={},N=[],C=N.slice,k,L={}.hasOwnProperty,A;!s(L,"undefined")&&!s(L.call,"undefined")?A=function(e,t){return L.call(e,t)}:A=function(e,t){return t in e&&s(e.constructor.prototype[t],"undefined")},Function.prototype.bind||(Function.prototype.bind=function(e){var t=self;if(typeof t!="function")throw new TypeError;var n=C.call(arguments,1),r=function(){if(self instanceof r){var i=function(){};i.prototype=t.prototype;var s=new i,o=t.apply(s,n.concat(C.call(arguments)));return Object(o)===o?o:s}return t.apply(e,n.concat(C.call(arguments)))};return r}),S.svg=function(){return!!t.createElementNS&&!!t.createElementNS(E.svg,"svg").createSVGRect};for(var O in S)A(S,O)&&(k=O.toLowerCase(),c[k]=S[O](),N.push((c[k]?"":"no-")+k));return c.addTest=function(e,t){if(typeof e=="object")for(var r in e)A(e,r)&&c.addTest(r,e[r]);else{e=e.toLowerCase();if(c[e]!==n)return c;t=typeof t=="function"?t():t,enableClasses&&(h.className+=" "+(t?"":"no-")+e),c[e]=t}return c},r(""),d=m=null,c._version=l,c._domPrefixes=w,c._cssomPrefixes=b,c.testProp=function(e){return u([e])},c.testAllProps=f,c.prefixed=function(e,t,n){return t?f(e,t,n):f(e,"pfx")},c}(self,self.document)},_defaultPreloader:function(t,n,r){var i='<div class="sequence-preloader"><svg class="preloading" xmlns="http://www.w3.org/2000/svg"><circle class="circle" cx="6" cy="6" r="6" /><circle class="circle" cx="22" cy="6" r="6" /><circle class="circle" cx="38" cy="6" r="6" /></svg></div>';e("head").append("<style>.sequence-preloader{height: 100%;position: absolute;width: 100%;z-index: 999999;}@"+r+"keyframes preload{0%{opacity: 1;}50%{opacity: 0;}100%{opacity: 1;}}.sequence-preloader .preloading .circle{fill: #ff9442;display: inline-block;height: 12px;position: relative;top: -50%;width: 12px;"+r+"animation: preload 1s infinite; animation: preload 1s infinite;}.preloading{display:block;height: 12px;margin: 0 auto;top: 50%;margin-top:-6px;position: relative;width: 48px;}.sequence-preloader .preloading .circle:nth-child(2){"+r+"animation-delay: .15s; animation-delay: .15s;}.sequence-preloader .preloading .circle:nth-child(3){"+r+"animation-delay: .3s; animation-delay: .3s;}.preloading-complete{opacity: 0;visibility: hidden;"+r+"transition-duration: 1s; transition-duration: 1s;}div.inline{background-color: #ff9442; margin-right: 4px; float: left;}</style>"),t.prepend(i),!ModernizrForSequence.svg&&!n?(e(".sequence-preloader").prepend('<div class="preloading"><div class="circle inline"></div><div class="circle inline"></div><div class="circle inline"></div></div>'),setInterval(function(){e(".sequence-preloader .circle").fadeToggle(500)},500)):n||setInterval(function(){e(".sequence-preloader").fadeToggle(500)},500)},_operaTest:function(){e("body").append('<span id="sequence-opera-test"></span>');var t=e("#sequence-opera-test");return t.css("-o-transition","1s"),t.css("-o-transition")!=="1s"?(t.remove(),!1):(t.remove(),!0)}};var r={startingFrameID:1,cycle:!0,animateStartingFrameIn:!1,transitionThreshold:!1,reverseAnimationsWhenNavigatingBackwards:!0,preventDelayWhenReversingAnimations:!1,moveActiveFrameToTop:!0,autoPlay:!1,autoPlayDirection:1,autoPlayDelay:5e3,navigationSkip:!0,navigationSkipThreshold:250,fadeFrameWhenSkipped:!0,fadeFrameTime:150,preventReverseSkipping:!1,nextButton:!1,showNextButtonOnInit:!0,prevButton:!1,showPrevButtonOnInit:!0,pauseButton:!1,unpauseDelay:null,pauseOnHover:!0,pauseIcon:!1,showPauseButtonOnInit:!0,pagination:!1,showPaginationOnInit:!0,preloader:!1,preloadTheseFrames:[1],preloadTheseImages:[],hideFramesUntilPreloaded:!0,prependPreloadingComplete:!0,hidePreloaderUsingCSS:!0,hidePreloaderDelay:0,keyNavigation:!0,numericKeysGoToFrames:!0,keyEvents:{left:"prev",right:"next"},customKeyEvents:{},swipeNavigation:!0,swipeThreshold:20,swipePreventsDefault:!1,swipeEvents:{left:"prev",right:"next",up:!1,down:!1},hashTags:!1,hashDataAttribute:!1,hashChangesOnFirstFrame:!1,fallback:{theme:"slide",speed:500}};e.fn.sequence=function(t){return this.each(function(){e.data(this,"sequence")||e.data(this,"sequence",new n(e(this),t,r))})}}(jQuery),define("jquery.sequence",function(){}),define("controllers/Transitioner",["base/Layout","tpl!templates/Transitioner.tpl.html","jquery.sequence"],function(e,t){return e.extend({template:t,initialize:function(e){if(!e.className)throw new Error("Transitioner expects the className to be passed to the options")},regions:{one:".slide1",two:".slide2"},sequenceOptions:{keyNavigation:!1,navigationSkip:!1},initTransitioner:function(){this.$el.addClass("init"),this.transitioner=this.$el.sequence(this.sequenceOptions).data("sequence"),this.$("li:first-child").addClass("animate-in"),this.transitioner.beforeNextFrameAnimatesIn=_.bind(this.setHeight,this);var e=_.bind(this.setHeight,this);e=_.debounce(e,100),$(window).resize(e)},onDomRefresh:function(){this.initTransitioner()},setHeight:function(){var e,t;$(window).width()<951?this.current==="one"?(e=100+this.$(".slide1 .col-last").height(),t=100+this.$(".slide2 .col-last").height()):(e=100+this.$(".slide2 .col-last").height(),t=100+this.$(".slide1 .col-last").height()):this.current==="one"?(e=this.$(".slide1").height(),t=this.$(".slide2").height()):(e=this.$(".slide2").height(),t=this.$(".slide1").height()),e>t?this.$el.removeClass("height-last").addClass("height-first"):this.$el.removeClass("height-first").addClass("height-last"),this.$el.css("height",e+"px")},initFirstSlide:function(){var e;$(window).width()<951?e=102+this.$(".slide1 .col-last").height():e=this.$(".slide1").height(),this.$el.css("height",e+"px"),this.$(".first").css("z-index","2")},display:function(e){this.current?this._display(e):(e.isAlreadyRendered()||this.regionManager.get("one").show(e),this.current="one",this.initFirstSlide())},_display:_.debounce(function(e){switch(this.current){case"one":this.regionManager.get("two").show(e),this.current="two",this.transitioner.goTo(2,1);break;default:this.regionManager.get("one").show(e),this.current="one",this.transitioner.goTo(1,1)}},500)})}),define("regions/HeaderRegion",["base/Region","base/views/ItemView","views/HeaderDetailView","tpl!templates/HeaderListView.tpl.html","controllers/Transitioner"],function(e,t,n,r,i){return e.extend({initialize:function(){this.context.currentAction&&this.context.currentAction==="show"?this.displayDetailView():this.displayListView(),this.context.listen(this,"action:list",this.displayListView),this.context.listen(this,"action:show",this.displayDetailView)},getTransitioner:function(){if(!this.transitioner){var e=new i({context:this.context,className:"transitioner"});e.isAlreadyRendered()?(this.attachView(e),e.initTransitioner()):this.show(e),this.transitioner=e}return this.transitioner},displayListView:function(){var e=this.getListView();this.getTransitioner().display(e)},displayDetailView:function(){var e=this.getDetailView();this.getTransitioner().display(e)},getDetailView:function(){return new n({context:this.context,model:this.context.nodes.get(this.context.currentDetail)})},getListView:function(){var e=new t({template:r,context:this.context,className:"header-list-view inner-content",selector:".header-list-view.inner-content"});return e}})}),define("base/views/CollectionView",["marionette","backbone.geppetto"],function(e,t){var n=e.CollectionView.extend({constructor:function(n){n&&n.context&&t.bindContext({view:this,context:n.context}),n&&n.selector&&(this.selector=n.selector),e.CollectionView.prototype.constructor.apply(this,arguments)}});return _.extend(n.prototype,{getExistingViewSelector:function(){return this.className?"."+this.className:!1},areItemViewsAlreadyRendered:function(){if(!this.collection||this.collection.length===0)return;this.showCollection()},renderItemView:function(e,t){if(e.isAlreadyRendered())return;e.render(),this.appendHtml(this,e,t)},isAlreadyRendered:function(){var e=this.selector||this.getExistingViewSelector(),t;if(e){t=$(e);if(t.length>0)return this.setElement(t),this.areItemViewsAlreadyRendered(),!0}return!1}}),n}),define("tpl!templates/NodeTeaserView.tpl.html",function(){return function(obj){var __p="",print=function(){__p+=Array.prototype.join.call(arguments,"")};with(obj||{})__p+='<header>\n  <ul class="meta">\n    <li>'+createDateFormatted+"</li>\n    <li>"+getTags()+"</li>\n    <li>"+author+'</li>\n  </ul>\n  <h2><a href="detail.html">'+title+"</a></h2>\n</header>";return __p}}),define("views/NodeTeaserView",["base/views/ItemView","tpl!../templates/NodeTeaserView.tpl.html"],function(e,t){return e.extend({template:t,className:"node-teaser-view",tagName:"article",events:{click:"goToDetail",mouseover:"highlight",mouseout:"stopHighlight"},templateHelpers:{getTags:function(){return this.tags?this.type+", "+this.tags.join(", "):this.type}},goToDetail:function(e){e.preventDefault(),this.context.router.goToDetail(this.model)},highlight:function(){this.$el.addClass("highlight")},stopHighlight:function(){this.$el.removeClass("highlight")}})}),define("tpl!templates/MainListView.tpl.html",function(){return function(obj){var __p="",print=function(){__p+=Array.prototype.join.call(arguments,"")};with(obj||{})__p+="<p>Main list view.</p>";return __p}}),define("tpl!templates/MainDetailView.tpl.html",function(){return function(obj){var __p="",print=function(){__p+=Array.prototype.join.call(arguments,"")};with(obj||{})__p+=""+content+"";return __p}}),define("regions/MainRegion",["base/Region","base/views/CollectionView","base/views/ItemView","views/NodeTeaserView","controllers/Transitioner","tpl!templates/MainListView.tpl.html","tpl!templates/MainDetailView.tpl.html"],function(e,t,n,r,i,s,o){return e.extend({initialize:function(){this.context.currentAction&&this.context.currentAction==="show"?this.displayDetailView():this.displayListView(),this.context.listen(this,"action:list",this.displayListView),this.context.listen(this,"action:show",this.displayDetailView)},displayListView:function(){var e=this.getListView();e.isAlreadyRendered()?this.attachView(e):this.show(e)},displayDetailView:function(){var e=this.getDetailView();e.isAlreadyRendered()?this.attachView(e):this.show(e)},getDetailView:function(){var e=new n({template:o,className:"main-detail-view inner-content",tagName:"article",model:this.context.nodes.get(this.context.currentDetail)});return e},getListView:function(){var e=new t({template:s,className:"main-list-view inner-content",selector:".main-list-view.inner-content",itemView:r,collection:this.context.nodes,itemViewOptions:{context:this.context}});return e}})}),define("tpl!templates/FooterView.tpl.html",function(){return function(obj){var __p="",print=function(){__p+=Array.prototype.join.call(arguments,"")};with(obj||{})__p+='<div class="susy-cols split-from-break-large split-ratio-1-5">\n  <div class="col">\n    <img src="/images/toon.jpg">\n  </div>\n  <div class="col-last">\n    <p class="intro">Hi. I’m Toon, I’m a freelance JavaScript developer.</p>\n    <p>I write client side and server side JavaScript code.</p>\n    <p>I love <em>backbone</em> and <em>marionette</em> to structure client side applications, use <em>requirejs</em> to keep everything in seperate files, create custom tasks with <em>grunt</em> to build projects, like to write tests with <em>mocha</em> and <em>chai</em>.</p>\n    <p>When it comes to visualizing data, I reach for <em>d3</em>.</p>\n    <p>Do you need some assistance with you application?</p>\n    <p><a href="mailto:hello@toon.io">Contact me</a></p>\n  </div>\n</div>\n<div class="hr"><hr></div>\n<div class="inner-content">\n  <p class="copyright">©2013 Toon Ketels</p>\n</div>';return __p}}),define("views/FooterView",["base/views/ItemView","tpl!templates/FooterView.tpl.html"],function(e,t){return e.extend({template:t,className:"footer-view inner-content",getExistingViewSelector:function(){return"."+this.className.replace(/\ /g,".")}})}),define("tpl!templates/ContactView.tpl.html",function(){return function(obj){var __p="",print=function(){__p+=Array.prototype.join.call(arguments,"")};with(obj||{})__p+='<p>Available for projects. Let’s talk.</p>\n<p>Contact:</p>\n<ul class="contact-links">\n  <li>+32 487 17 60 95</li>\n  <li><a href="mailto:hello@toon.io">hello@toon.io</a></li>\n  <li class="tw">\n    <a href="http://twitter.com/toonketels">\n      <span class="icon"></span>\n      <span class="label">Twitter</span>\n    </a>\n  </li>\n  <li class="in">\n    <a href="https://www.linkedin.com/in/toonketels">\n      <span class="icon"></span>\n      <span class="label">LinkedIn</span>\n    </a>\n  </li>\n  <li class="gh">\n    <a href="https://github.com/toonketels">\n      <span class="icon"></span>\n      <span class="label">Github</span>\n    </a>\n  </li>\n</ul>';return __p}}),define("views/ContactView",["base/views/ItemView","tpl!templates/ContactView.tpl.html","underscore"],function(e,t,n){return e.extend({template:t,className:"contact-view inner-content",getExistingViewSelector:function(){return"."+this.className.replace(/\ /g,".")}})}),define("commands/BootstrapViewsCommand",["underscore","marionette","backbone.geppetto","regions/HeaderRegion","regions/MainRegion","views/FooterView","views/ContactView"],function(e,t,n,r,i,s,o){var u=function(){};return e.extend(u.prototype,{execute:function(){setTimeout(function(e){e.initializeRegions(),e.initializeFooterView(),e.initializeContactView()},0,this)},initializeRegions:function(){var e=new t.RegionManager;this.context.regions=e,this.regions=e.addRegions({contact:"#contact",header:{selector:"#header",regionType:r},main:{selector:"#content",regionType:i},footer:"#footer"},{options:{context:this.context}})},initializeContactView:function(){var e=new o({context:this.context});e.isAlreadyRendered()?this.regions.contact.attachView(e):this.regions.contact.show(e)},initializeFooterView:function(){var e=new s({context:this.context});e.isAlreadyRendered()?this.regions.footer.attachView(e):this.regions.footer.show(e)}}),u}),function(e){function f(e,t){var n=e.length;while(n--)if(e[n]===t)return n;return-1}function l(e,t){if(e.length!=t.length)return!1;for(var n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function h(e){for(t in r)r[t]=e[c[t]]}function p(e,t){var i,o,u,l,c;i=e.keyCode,f(a,i)==-1&&a.push(i);if(i==93||i==224)i=91;if(i in r){r[i]=!0;for(u in s)s[u]==i&&(m[u]=!0);return}h(e);if(!m.filter.call(this,e))return;if(!(i in n))return;for(l=0;l<n[i].length;l++){o=n[i][l];if(o.scope==t||o.scope=="all"){c=o.mods.length>0;for(u in r)if(!r[u]&&f(o.mods,+u)>-1||r[u]&&f(o.mods,+u)==-1)c=!1;(o.mods.length==0&&!r[16]&&!r[18]&&!r[17]&&!r[91]||c)&&o.method(e,o)===!1&&(e.preventDefault?e.preventDefault():e.returnValue=!1,e.stopPropagation&&e.stopPropagation(),e.cancelBubble&&(e.cancelBubble=!0))}}}function d(e){var t=e.keyCode,n,i=f(a,t);i>=0&&a.splice(i,1);if(t==93||t==224)t=91;if(t in r){r[t]=!1;for(n in s)s[n]==t&&(m[n]=!1)}}function v(){for(t in r)r[t]=!1;for(t in s)m[t]=!1}function m(e,t,r){var i,s;i=T(e),r===undefined&&(r=t,t="all");for(var o=0;o<i.length;o++)s=[],e=i[o].split("+"),e.length>1&&(s=N(e),e=[e[e.length-1]]),e=e[0],e=u(e),e in n||(n[e]=[]),n[e].push({shortcut:i[o],scope:t,method:r,key:i[o],mods:s})}function g(e,t){var r=e.split("+"),i=[],s,o;r.length>1&&(i=N(r),e=r[r.length-1]),e=u(e),t===undefined&&(t=S());if(!n[e])return;for(s in n[e])o=n[e][s],o.scope===t&&l(o.mods,i)&&(n[e][s]={})}function y(e){return typeof e=="string"&&(e=u(e)),f(a,e)!=-1}function b(){return a.slice(0)}function w(e){var t=(e.target||e.srcElement).tagName;return t!="INPUT"&&t!="SELECT"&&t!="TEXTAREA"}function E(e){i=e||"all"}function S(){return i||"all"}function x(e){var t,r,i;for(t in n){r=n[t];for(i=0;i<r.length;)r[i].scope===e?r.splice(i,1):i++}}function T(e){var t;return e=e.replace(/\s/g,""),t=e.split(","),t[t.length-1]==""&&(t[t.length-2]+=","),t}function N(e){var t=e.slice(0,e.length-1);for(var n=0;n<t.length;n++)t[n]=s[t[n]];return t}function C(e,t,n){e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent&&e.attachEvent("on"+t,function(){n(window.event)})}function L(){var t=e.key;return e.key=k,t}var t,n={},r={16:!1,18:!1,17:!1,91:!1},i="all",s={"⇧":16,shift:16,"⌥":18,alt:18,option:18,"⌃":17,ctrl:17,control:17,"⌘":91,command:91},o={backspace:8,tab:9,clear:12,enter:13,"return":13,esc:27,escape:27,space:32,left:37,up:38,right:39,down:40,del:46,"delete":46,home:36,end:35,pageup:33,pagedown:34,",":188,".":190,"/":191,"`":192,"-":189,"=":187,";":186,"'":222,"[":219,"]":221,"\\":220},u=function(e){return o[e]||e.toUpperCase().charCodeAt(0)},a=[];for(t=1;t<20;t++)o["f"+t]=111+t;var c={16:"shiftKey",18:"altKey",17:"ctrlKey",91:"metaKey"};for(t in s)m[t]=!1;C(document,"keydown",function(e){p(e,i)}),C(document,"keyup",d),C(window,"focus",v);var k=e.key;e.key=m,e.key.setScope=E,e.key.getScope=S,e.key.deleteScope=x,e.key.filter=w,e.key.isPressed=y,e.key.getPressedKeyCodes=b,e.key.noConflict=L,e.key.unbind=g,typeof module!="undefined"&&(module.exports=key)}(this),define("keymaster",function(){}),function(){var e;e=function(e){return this.cid=_.uniqueId("backbone.shortcuts"),this.initialize.apply(this,arguments),this.delegateShortcuts()},_.extend(e.prototype,Backbone.Events,{initialize:function(){},delegateShortcuts:function(){var e,t,n,r,i,s,o,u;if(!this.shortcuts)return;o=this.shortcuts,u=[];for(i in o){e=o[i];if(!_.isFunction(e)){n=this[e];if(!n)throw new Error("Method "+e+" does not exist")}else n=e;t=i.match(/^(\S+)\s*(.*)$/),s=t[1],r=t[2]===""?"all":t[2],n=_.bind(n,this),u.push(key(s,r,n))}return u}}),Backbone.Shortcuts=e,Backbone.Shortcuts.extend=Backbone.View.extend}.call(this),define("backbone.shortcuts",function(){}),define("controllers/ShortcutsController",["marionette","backbone","underscore","backbone.shortcuts"],function(e,t,n){return e.Controller.extend({initialize:function(e){this.context=e.context,n.extend(this,new t.Shortcuts),this.delegateShortcuts()},shortcuts:{"ctrl+o":"displayList",right:"next",left:"previous",up:"displayList"},displayList:function(){this.context.router.navigate("",{trigger:!0})},next:function(){var e=this.context.nodes.next();e&&this.context.router.goToDetail(e)},previous:function(){var e=this.context.nodes.previous();e&&this.context.router.goToDetail(e)}})}),define("commands/BootstrapShortcutsCommand",["underscore","controllers/ShortcutsController"],function(e,t){var n=function(){};return e.extend(n.prototype,{execute:function(){this.context=new t({context:this.context})}}),n}),define("base/Controller",["marionette","backbone.geppetto"],function(e,t){return e.Controller.extend({constructor:function(n){n&&n.context&&t.bindContext({view:this,context:n.context}),e.Controller.prototype.constructor.apply(this,arguments)}})}),function(e,t){var n=e.document,r;r=function(){var r={},i={},s=!1,o={ENTER:13,ESC:27,SPACE:32},u=[],a,f,l,c,h,p,d,v,m,g,y,b;return i={buttons:{holder:'<nav class="alertify-buttons">{{buttons}}</nav>',submit:'<button type="submit" class="alertify-button alertify-button-ok" id="alertify-ok">{{ok}}</button>',ok:'<button class="alertify-button alertify-button-ok" id="alertify-ok">{{ok}}</button>',cancel:'<button class="alertify-button alertify-button-cancel" id="alertify-cancel">{{cancel}}</button>'},input:'<div class="alertify-text-wrapper"><input type="text" class="alertify-text" id="alertify-text"></div>',message:'<p class="alertify-message">{{message}}</p>',log:'<article class="alertify-log{{class}}">{{message}}</article>'},b=function(){var e,r,i=!1,s=n.createElement("fakeelement"),o={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"otransitionend",transition:"transitionend"};for(e in o)if(s.style[e]!==t){r=o[e],i=!0;break}return{type:r,supported:i}},a=function(e){return n.getElementById(e)},r={labels:{ok:"OK",cancel:"Cancel"},delay:5e3,buttonReverse:!1,buttonFocus:"ok",transition:t,addListeners:function(e){var t=typeof l!="undefined",r=typeof f!="undefined",i=typeof y!="undefined",s="",u=this,a,h,p,d,v;a=function(t){return typeof t.preventDefault!="undefined"&&t.preventDefault(),p(t),typeof y!="undefined"&&(s=y.value),typeof e=="function"&&(typeof y!="undefined"?e(!0,s):e(!0)),!1},h=function(t){return typeof t.preventDefault!="undefined"&&t.preventDefault(),p(t),typeof e=="function"&&e(!1),!1},p=function(e){u.hide(),u.unbind(n.body,"keyup",d),u.unbind(c,"focus",v),i&&u.unbind(g,"submit",a),t&&u.unbind(l,"click",a),r&&u.unbind(f,"click",h)},d=function(e){var t=e.keyCode;t===o.SPACE&&!i&&a(e),t===o.ESC&&r&&h(e)},v=function(e){i?y.focus():!r||u.buttonReverse?l.focus():f.focus()},this.bind(c,"focus",v),t&&this.bind(l,"click",a),r&&this.bind(f,"click",h),this.bind(n.body,"keyup",d),i&&this.bind(g,"submit",a),this.transition.supported||this.setFocus()},bind:function(e,t,n){typeof e.addEventListener=="function"?e.addEventListener(t,n,!1):e.attachEvent&&e.attachEvent("on"+t,n)},handleErrors:function(){if(typeof e.onerror!="undefined"){var t=this;return e.onerror=function(e,n,r){t.error("["+e+" on line "+r+" of "+n+"]",0)},!0}return!1},appendButtons:function(e,t){return this.buttonReverse?t+e:e+t},build:function(e){var t="",n=e.type,s=e.message,o=e.cssClass||"";t+='<div class="alertify-dialog">',r.buttonFocus==="none"&&(t+='<a href="#" id="alertify-noneFocus" class="alertify-hidden"></a>'),n==="prompt"&&(t+='<form id="alertify-form">'),t+='<article class="alertify-inner">',t+=i.message.replace("{{message}}",s),n==="prompt"&&(t+=i.input),t+=i.buttons.holder,t+="</article>",n==="prompt"&&(t+="</form>"),t+='<a id="alertify-resetFocus" class="alertify-resetFocus" href="#">Reset Focus</a>',t+="</div>";switch(n){case"confirm":t=t.replace("{{buttons}}",this.appendButtons(i.buttons.cancel,i.buttons.ok)),t=t.replace("{{ok}}",this.labels.ok).replace("{{cancel}}",this.labels.cancel);break;case"prompt":t=t.replace("{{buttons}}",this.appendButtons(i.buttons.cancel,i.buttons.submit)),t=t.replace("{{ok}}",this.labels.ok).replace("{{cancel}}",this.labels.cancel);break;case"alert":t=t.replace("{{buttons}}",i.buttons.ok),t=t.replace("{{ok}}",this.labels.ok);break;default:}return v.className="alertify alertify-"+n+" "+o,d.className="alertify-cover",t},close:function(e,t){var n=t&&!isNaN(t)?+t:this.delay,r=this,i,s;this.bind(e,"click",function(){i(e)}),s=function(e){e.stopPropagation(),r.unbind(this,r.transition.type,s),m.removeChild(this),m.hasChildNodes()||(m.className+=" alertify-logs-hidden")},i=function(e){typeof e!="undefined"&&e.parentNode===m&&(r.transition.supported?(r.bind(e,r.transition.type,s),e.className+=" alertify-log-hide"):(m.removeChild(e),m.hasChildNodes()||(m.className+=" alertify-logs-hidden")))};if(t===0)return;setTimeout(function(){i(e)},n)},dialog:function(e,t,r,i,o){p=n.activeElement;var a=function(){if(m&&m.scrollTop!==null&&d&&d.scrollTop!==null)return;a()};if(typeof e!="string")throw new Error("message must be a string");if(typeof t!="string")throw new Error("type must be a string");if(typeof r!="undefined"&&typeof r!="function")throw new Error("fn must be a function");return typeof this.init=="function"&&(this.init(),a()),u.push({type:t,message:e,callback:r,placeholder:i,cssClass:o}),s||this.setup(),this},extend:function(e){if(typeof e!="string")throw new Error("extend method must have exactly one paramter");return function(t,n){return this.log(t,e,n),this}},hide:function(){var e,t=this;u.splice(0,1),u.length>0?this.setup(!0):(s=!1,e=function(n){n.stopPropagation(),v.className+=" alertify-isHidden",t.unbind(v,t.transition.type,e)},this.transition.supported?(this.bind(v,this.transition.type,e),v.className="alertify alertify-hide alertify-hidden"):v.className="alertify alertify-hide alertify-hidden alertify-isHidden",d.className="alertify-cover alertify-cover-hidden",p.focus())},init:function(){n.createElement("nav"),n.createElement("article"),n.createElement("section"),d=n.createElement("div"),d.setAttribute("id","alertify-cover"),d.className="alertify-cover alertify-cover-hidden",n.body.appendChild(d),v=n.createElement("section"),v.setAttribute("id","alertify"),v.className="alertify alertify-hidden",n.body.appendChild(v),m=n.createElement("section"),m.setAttribute("id","alertify-logs"),m.className="alertify-logs alertify-logs-hidden",n.body.appendChild(m),n.body.setAttribute("tabindex","0"),this.transition=b(),delete this.init},log:function(e,t,n){var r=function(){if(m&&m.scrollTop!==null)return;r()};return typeof this.init=="function"&&(this.init(),r()),m.className="alertify-logs",this.notify(e,t,n),this},notify:function(e,t,r){var i=n.createElement("article");i.className="alertify-log"+(typeof t=="string"&&t!==""?" alertify-log-"+t:""),i.innerHTML=e,m.appendChild(i),setTimeout(function(){i.className=i.className+" alertify-log-show"},50),this.close(i,r)},set:function(e){var t;if(typeof e!="object"&&e instanceof Array)throw new Error("args must be an object");for(t in e)e.hasOwnProperty(t)&&(this[t]=e[t])},setFocus:function(){y?(y.focus(),y.select()):h.focus()},setup:function(e){var n=u[0],i=this,o;s=!0,o=function(e){e.stopPropagation(),i.setFocus(),i.unbind(v,i.transition.type,o)},this.transition.supported&&!e&&this.bind(v,this.transition.type,o),v.innerHTML=this.build(n),c=a("alertify-resetFocus"),l=a("alertify-ok")||t,f=a("alertify-cancel")||t,h=r.buttonFocus==="cancel"?f:r.buttonFocus==="none"?a("alertify-noneFocus"):l,y=a("alertify-text")||t,g=a("alertify-form")||t,typeof n.placeholder=="string"&&n.placeholder!==""&&(y.value=n.placeholder),e&&this.setFocus(),this.addListeners(n.callback)},unbind:function(e,t,n){typeof e.removeEventListener=="function"?e.removeEventListener(t,n,!1):e.detachEvent&&e.detachEvent("on"+t,n)}},{alert:function(e,t,n){return r.dialog(e,"alert",t,"",n),this},confirm:function(e,t,n){return r.dialog(e,"confirm",t,"",n),this},extend:r.extend,init:r.init,log:function(e,t,n){return r.log(e,t,n),this},prompt:function(e,t,n,i){return r.dialog(e,"prompt",t,n,i),this},success:function(e,t){return r.log(e,"success",t),this},error:function(e,t){return r.log(e,"error",t),this},set:function(e){r.set(e)},labels:r.labels,debug:r.handleErrors}},typeof define=="function"?define("alertify",[],function(){return new r}):typeof e.alertify=="undefined"&&(e.alertify=new r)}(this),define("controllers/Alertify",["base/Controller","alertify"],function(e,t){return e.extend({initialize:function(){this.context.alertify=t}})}),define("commands/BootstrapNotificationsCommand",["underscore","controllers/Alertify"],function(e,t){var n=function(){};return e.extend(n.prototype,{execute:function(){new t({context:this.context})}}),n}),define("core/AppContext",["backbone.geppetto","commands/BootstrapRouterCommand","commands/BootstrapNodesCommand","commands/BootstrapViewsCommand","commands/BootstrapShortcutsCommand","commands/BootstrapNotificationsCommand"],function(e,t,n,r,i,s){return e.Context.extend({startup:function(){var e="app:startup";this.mapCommand(e,t),this.mapCommand(e,n),this.mapCommand(e,s),this.mapCommand(e,r),this.mapCommand(e,i),this.dispatch(e),window.context=this}})}),define("app",["marionette","backbone","core/AppContext"],function(e,t,n){var r=new e.Application;return r.addInitializer(function(e){var t=new n;t.startup()}),r.on("initialize:after",function(){t.history.start({pushState:!0})}),r}),define("base/overrides/marionette",["marionette"],function(e){e.Region.buildRegion=function(e,t){var n=typeof e=="string",r=typeof e.selector=="string",i=typeof e.regionType=="undefined",s=typeof e=="function",o=e.options||{};if(!s&&!n&&!r)throw new Error("Region must be specified as a Region type, a selector string or an object with selector property");var u,a;n&&(u=e),e.selector&&(u=e.selector),s&&(a=e),!s&&i&&(a=t),e.regionType&&(a=e.regionType);var o=_.defaults({el:u},o),f=new a(o);return e.parentEl&&(f.getEl=function(t){var n=e.parentEl;return _.isFunction(n)&&(n=n()),n.find(t)}),f}}),require(["app","base/overrides/marionette"],function(e){NProgress.set(.5),e.start(),window.app=e,$("body").addClass("initialized"),NProgress.done()}),define("main",function(){})})();